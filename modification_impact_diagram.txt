╔═══════════════════════════════════════════════════════════════════════════╗
║                     修改影响可视化图                                       ║
╚═══════════════════════════════════════════════════════════════════════════╝

┌─────────────────────────────────────────────────────────────────────────┐
│  修改优先级矩阵                                                          │
└─────────────────────────────────────────────────────────────────────────┘

         高影响
           ↑
           │
    🔴 M1  │                      M1 = 越界验证
    🔴 M2  │                      M2 = 变换一致性
           │
           │         🟡 M3        M3 = 参数调整
           │
    ───────┼──────────────────→
           │                      低紧急 → 高紧急
           │    🟢 M4
           │    🟢 M5             M4 = 文档增强
           │                      M5 = 可选功能
           ↓
         低影响

═══════════════════════════════════════════════════════════════════════════

┌─────────────────────────────────────────────────────────────────────────┐
│  γ_t 轨迹对比（核心修改：tau_n_max）                                    │
└─────────────────────────────────────────────────────────────────────────┘

场景：你有25次采样预算

【原始配置】tau_n_max=40, gamma_min=0.1
γ_t
0.5 ┤■■■■■■
    │      ■■■■■■
0.4 │            ■■■■■■
    │                  ■■■■■■
0.3 │                        ■■ ← n=25时仍在探索！
    │                          ■■■■■■
0.2 │                                ■■■■■■
    │                                      ■■■■
0.1 │                                          ■■■■
    └────┬────┬────┬────┬────┬────┬────┬────┬────┬
         5   10   15   20   25   30   35   40   45  样本数(n)

【调整配置】tau_n_max=20, gamma_min=0.05  ✅ 推荐
γ_t
0.5 ┤■■■■■■
    │      ■■■■■■
0.4 │            ■■■■
    │                ■■■■
0.3 │                    ■■■
    │                       ■■
0.2 │                         ■■
    │                           ■
0.1 │                            ■ ← n=25时已精细化！
    │                             ■■■■■■■■■■
0.05│                                         ■■■■■
    └────┬────┬────┬────┬────┬────┬────┬────┬────┬
         5   10   15   20   25   30   35   40   45  样本数(n)

关键差异：
  原始：n=25时 γ_t=0.28 → 28%覆盖 + 72%信息
  调整：n=25时 γ_t=0.05 → 5%覆盖 + 95%信息 ← 更聚焦效应！

═══════════════════════════════════════════════════════════════════════════

┌─────────────────────────────────────────────────────────────────────────┐
│  变换一致性修复前后对比（核心修改：Bug修复）                             │
└─────────────────────────────────────────────────────────────────────────┘

假设模型有 StandardScaler: X_norm = (X - mean) / std
原始空间：X ∈ [0, 100]，变换后：X_norm ∈ [-2, 2]

【修改前】❌ 尺度不匹配
┌─────────────────────┐      ┌─────────────────────┐
│ 训练数据（原始）     │      │ 候选点（变换后）     │
│ X_train = [0, 100]  │      │ X_cand = [-2, 2]    │
│         ↓           │      │         ↓           │
│   _feature_ranges   │      │  _canonicalize      │
│         ↓           │      │         ↓           │
│  span = 100  ───────┼──────┼─→ 错误！扰动尺度    │
│                     │      │   sigma = 0.1×100   │
│                     │      │        = 10 !!      │
│                     │      │   (远大于 [-2,2])   │
└─────────────────────┘      └─────────────────────┘
                                      ↓
                            局部扰动完全错误！
                            X_local = X_cand ± 10
                            → 越界，ANOVA分解失败

【修改后】✅ 尺度一致
┌─────────────────────┐      ┌─────────────────────┐
│ 训练数据（变换后）   │      │ 候选点（变换后）     │
│ X_train_norm=[-2,2] │      │ X_cand = [-2, 2]    │
│         ↓           │      │         ↓           │
│   _feature_ranges   │      │  _canonicalize      │
│         ↓           │      │         ↓           │
│  span = 4  ─────────┼──────┼─→ 正确！扰动尺度    │
│                     │      │   sigma = 0.1×4     │
│                     │      │        = 0.4 ✓      │
│                     │      │   (合理的局部探索)  │
└─────────────────────┘      └─────────────────────┘
                                      ↓
                            局部扰动正确！
                            X_local = X_cand ± 0.4
                            → ANOVA分解准确

═══════════════════════════════════════════════════════════════════════════

┌─────────────────────────────────────────────────────────────────────────┐
│  不确定性采样 vs 信息增益（为什么不改？）                                │
└─────────────────────────────────────────────────────────────────────────┘

你的场景：6个变量，不知道哪些效应存在，20次采样预算

【不确定性采样】当前实现 ✅
采样轨迹（效应空间）:
    Dim3
     ↑
   6 │  ◆     ◆           ◆ = 第1-10次（广泛探索）
   5 │    ◆  ◆◆           ● = 第11-15次（识别A×C交互）
   4 │      ●●            ■ = 第16-20次（精细化A×C）
   3 │  ◆  ●●■■
   2 │    ●■■■  ◆
   1 │◆   ■■    ◆  ◆
   0 └─────────────────→ Dim1
     0 1 2 3 4 5 6

结果：✅ 成功发现 A 主效应、C 主效应、A×C 交互
     ✅ 正确识别 B 无效应（扰动后不确定性不变）

【信息增益】如果修改 ❌
采样轨迹（效应空间）:
    Dim3
     ↑
   6 │  ◆                 ◆ = 第1-10次（随机探索）
   5 │    ◆               ● = 第11-15次（误判B重要，聚焦A×B）
   4 │      ◆             ■ = 第16-20次（发现错误，但预算不足）
   3 │  ◆
   2 │●●●●●● ◆  ← 过度聚焦A×B（错误方向！）
   1 │●●●●●  ■■ ← 晚期才探索A×C（样本不足）
   0 └─────────────────→ Dim1
     0 1 2 3 4 5 6

结果：❌ 漏掉 A×C 交互（功效不足）
     ❌ 误判 B 为重要因子（过度采样导致）
     ❌ 采样分布不均衡（统计分析困难）

═══════════════════════════════════════════════════════════════════════════

┌─────────────────────────────────────────────────────────────────────────┐
│  修改时间线                                                              │
└─────────────────────────────────────────────────────────────────────────┘

Week 1 (必须完成):
Day 1-2  [████████████░░░░░░░░] 修复Bug (60%)
         ├─ 越界验证
         └─ 变换一致性

Day 3    [████████████████░░░░] 参数优化 (80%)
         └─ 调整 tau_n_max

Day 4    [████████████████████] 验证测试 (100%)
         ├─ 回归测试
         └─ 配置验证

Week 2 (建议增强):
Day 5-6  [████████░░░░░░░░░░░░] 文档增强 (40%)
Day 7    [████████████░░░░░░░░] 可选功能 (60%)

═══════════════════════════════════════════════════════════════════════════

┌─────────────────────────────────────────────────────────────────────────┐
│  风险评估                                                                │
└─────────────────────────────────────────────────────────────────────────┘

修改项         │ 破坏风险 │ 回滚难度 │ 测试覆盖
───────────────┼─────────┼─────────┼─────────
越界验证       │  🟢 低   │  🟢 易   │  ✅ 高
变换一致性     │  🟡 中   │  🟢 易   │  ✅ 高
参数调整       │  🟢 低   │  🟢 易   │  ✅ 中
文档增强       │  🟢 无   │  🟢 易   │  N/A
可选功能       │  🟢 无   │  🟢 易   │  ⚠️ 低

总体风险：🟢 低（所有修改都有降级路径）

═══════════════════════════════════════════════════════════════════════════

┌─────────────────────────────────────────────────────────────────────────┐
│  核心结论                                                                │
└─────────────────────────────────────────────────────────────────────────┘

✅ 你的代码设计理念完全正确（不确定性采样）
✅ 只需修复 2 个技术性 Bug
✅ 调整 1 个参数以适配你的采样预算
✅ 其余都是可选的文档/工具增强

不要被评价吓到！你的核心逻辑无需改变。

╔═══════════════════════════════════════════════════════════════════════════╗
║  下一步：确认计划 → 开始实施第1阶段（Bug修复）                            ║
╚═══════════════════════════════════════════════════════════════════════════╝
