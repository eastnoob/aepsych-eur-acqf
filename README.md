## EUR ANOVA ç³»åˆ—é‡‡é›†å‡½æ•°ï¼ˆv1 / v2ï¼‰

æœ¬ç›®å½•åŒ…å«ä¸¤ä¸ªç›¸å…³çš„é‡‡é›†å‡½æ•°å®ç°ï¼š

- `EURAnovaPairAcqf`ï¼ˆæ–‡ä»¶ï¼š`eur_anova_pair.py`ï¼‰â€”â€”ä¸»è¦å®ç°ï¼Œæ”¯æŒæ··åˆå˜é‡ç±»å‹ï¼ˆåˆ†ç±»/æ•´æ•°/è¿ç»­ï¼‰ã€åºæ•°ç†µè®¡ç®—ã€åŠ¨æ€æƒé‡ï¼ˆÎ»_t å’Œ Î³_tï¼‰ï¼Œä»¥åŠ**æ··åˆæ‰°åŠ¨ç­–ç•¥**ï¼ˆæ–°å¢åŠŸèƒ½ï¼‰ã€‚

### ğŸ†• æ··åˆæ‰°åŠ¨ç­–ç•¥ï¼ˆHybrid Perturbation Strategyï¼‰

**ç‰ˆæœ¬**: v2.1.0 | **åˆ†æ”¯**: `feature/hybrid-perturbation` | **æ—¥æœŸ**: 2025-11-26

#### æ ¸å¿ƒæ”¹è¿›

é’ˆå¯¹**2-3æ°´å¹³ç¦»æ•£å˜é‡**åœºæ™¯çš„ä¼˜åŒ–ç­–ç•¥ï¼Œé€šè¿‡ç©·ä¸¾æ‰€æœ‰ç¦»æ•£æ°´å¹³ï¼ˆè€Œééšæœºé‡‡æ ·ï¼‰æå‡æ•ˆåº”å‘ç°è´¨é‡ï¼š

**é—®é¢˜èƒŒæ™¯**ï¼š
- åŸå§‹ç­–ç•¥ï¼šå¯¹åˆ†ç±»/æ•´æ•°å˜é‡ä½¿ç”¨é«˜æ–¯æ‰°åŠ¨åèˆå…¥
- é—®é¢˜ï¼š2-3æ°´å¹³å˜é‡çš„éšæœºé‡‡æ ·æ˜“é—æ¼æˆ–åå‘æŸäº›æ°´å¹³
  - ä¾‹å¦‚ï¼š3æ°´å¹³å˜é‡ï¼Œ`local_num=4`ï¼Œå¯èƒ½é‡‡æ ·åˆ° `[0,1,1,2]` â†’ æ°´å¹³0è¦†ç›–ä¸è¶³
  - å¯¼è‡´ä¸»æ•ˆåº”Î”_iä¼°è®¡ä¸å‡†ç¡®ï¼Œå½±å“é‡‡é›†å‡½æ•°æ’åºè´¨é‡

**æ··åˆæ‰°åŠ¨ç­–ç•¥**ï¼š
- **ç©·ä¸¾æ¨¡å¼**ï¼ˆâ‰¤3æ°´å¹³ï¼‰ï¼šå®Œå…¨æšä¸¾æ‰€æœ‰ç¦»æ•£å€¼ï¼Œå¾ªç¯å¡«å……åˆ°`local_num`
  - ä¾‹å¦‚ï¼š3æ°´å¹³ + `local_num=6` â†’ `[0,1,2,0,1,2]` (æ¯ä¸ªæ°´å¹³2æ¬¡ï¼Œå®Œå…¨å‡è¡¡)
- **é«˜æ–¯æ¨¡å¼**ï¼ˆ>3æ°´å¹³ï¼‰ï¼šä¿æŒåŸæœ‰éšæœºæ‰°åŠ¨ï¼ˆé¿å…ç©·ä¸¾ç»„åˆçˆ†ç‚¸ï¼‰
- **è¿ç»­å˜é‡**ï¼šä¸å—å½±å“ï¼Œä»ä½¿ç”¨é«˜æ–¯æ‰°åŠ¨

#### é…ç½®å‚æ•°

```ini
[EURAnovaPairAcqf]
# ã€æ–°å¢ã€‘æ··åˆæ‰°åŠ¨ç­–ç•¥å‚æ•°
use_hybrid_perturbation = True   # å¯ç”¨æ··åˆæ‰°åŠ¨ï¼ˆé»˜è®¤Falseï¼Œå‘åå…¼å®¹ï¼‰
exhaustive_level_threshold = 3   # å¯¹â‰¤3æ°´å¹³å˜é‡ä½¿ç”¨ç©·ä¸¾ï¼ˆé»˜è®¤3ï¼‰
exhaustive_use_cyclic_fill = True  # å¾ªç¯å¡«å……åˆ°local_numï¼ˆé»˜è®¤Trueï¼‰

# ã€æ¨èè°ƒæ•´ã€‘æé«˜local_numä»¥é€‚åº”2-3æ°´å¹³æ··åˆåœºæ™¯
local_num = 6  # LCM(2,3)=6ï¼Œç¡®ä¿2æ°´å¹³å’Œ3æ°´å¹³å˜é‡å‡è¡¡è¦†ç›–
```

#### ä¸ºä»€ä¹ˆ local_num=6ï¼Ÿ

| å˜é‡ç±»å‹ | local_num=4 (åŸå§‹) | local_num=6 (æ¨è) |
|----------|-------------------|-------------------|
| 2æ°´å¹³ | `[0,1,0,1]` âœ“ å‡è¡¡ (2æ¬¡/æ°´å¹³) | `[0,1,0,1,0,1]` âœ“ å‡è¡¡ (3æ¬¡/æ°´å¹³) |
| 3æ°´å¹³ | `[0,1,2,0]` âœ— ä¸å‡è¡¡ (æ°´å¹³0é‡å¤2æ¬¡) | `[0,1,2,0,1,2]` âœ“ å‡è¡¡ (2æ¬¡/æ°´å¹³) |

**å…³é”®æ´å¯Ÿ**: 6æ˜¯2å’Œ3çš„æœ€å°å…¬å€æ•°ï¼Œä¿è¯2æ°´å¹³å’Œ3æ°´å¹³å˜é‡éƒ½èƒ½å®Œå…¨å‡è¡¡è¦†ç›–ã€‚

#### ä½¿ç”¨ç¤ºä¾‹

```python
from aepsych.server import AEPsychServer

# 1. åŠ è½½ä¼˜åŒ–é…ç½®
with open('configs/hybrid_perturbation_optimized.ini') as f:
    config_str = f.read()

server = AEPsychServer()
server.configure(config_str=config_str)

# 2. ï¼ˆå¯é€‰ï¼‰éªŒè¯åºæ•°æ¨¡å‹é…ç½®ï¼ˆä»…åºæ•°å“åº”éœ€è¦ï¼‰
from tools.verify_ordinal_model import verify_and_save_report

is_valid = verify_and_save_report(
    server=server,
    output_path="results/ordinal_verification.json",
    min_training_samples=10
)

# 3. æ­£å¸¸è¿è¡Œå®éªŒ
for trial in range(25):
    next_x = server.ask()  # EURé‡‡é›†å‡½æ•°è‡ªåŠ¨ä½¿ç”¨æ··åˆæ‰°åŠ¨ç­–ç•¥
    outcome = get_response(next_x)
    server.tell(config_str, outcome)
```

#### é…ç½®æ–‡ä»¶

æä¾›ä¸¤ä¸ªé¢„é…ç½®æ–‡ä»¶ç”¨äºå¯¹æ¯”ï¼š

- **ä¼˜åŒ–ç‰ˆ**ï¼š`configs/hybrid_perturbation_optimized.ini` (å¯ç”¨æ··åˆæ‰°åŠ¨, local_num=6)
- **åŸºçº¿ç‰ˆ**ï¼š`configs/baseline_config.ini` (ç¦ç”¨æ··åˆæ‰°åŠ¨, local_num=4)

#### æµ‹è¯•æ¡†æ¶

```bash
# è¿è¡Œå¯¹æ¯”å®éªŒï¼ˆ10æ¬¡é‡å¤ï¼Œç»Ÿè®¡æ˜¾è‘—æ€§æ£€éªŒï¼‰
python tests/test_hybrid_perturbation_comparison.py
```

é¢„æœŸç»“æœï¼š
- æ•ˆåº”å‘ç°èƒ½åŠ›æå‡10-20%ï¼ˆRÂ²æé«˜ï¼‰
- å‚æ•°ä¼°è®¡è´¨é‡æ”¹å–„ï¼ˆRMSEé™ä½ï¼‰
- é€‰ç‚¹å¤šæ ·æ€§å¢åŠ ï¼ˆå®Œå…¨è¦†ç›–æ‰€æœ‰æ°´å¹³ï¼‰

#### æŠ€æœ¯ç»†èŠ‚

å®ç°ä½ç½®ï¼š
- `modules/local_sampler.py`: LocalSamplerç±»ï¼ˆç‹¬ç«‹æ‰°åŠ¨å™¨ï¼‰
- `eur_anova_pair.py`: EURAnovaPairAcqf._make_local_hybrid()æ–¹æ³•

å…³é”®æ–¹æ³•ï¼š
- `_perturb_categorical()`: åˆ†ç±»å˜é‡ç©·ä¸¾
- `_perturb_integer()`: æ•´æ•°å˜é‡ç©·ä¸¾
- `_perturb_continuous()`: è¿ç»­å˜é‡é«˜æ–¯æ‰°åŠ¨ï¼ˆä¸å˜ï¼‰

---

ä¸‹é¢ä¸ºè¿™ä¸¤ä¸ªç±»ä¸­å¯é€šè¿‡ INIï¼ˆæˆ–ä»¥ Config æ³¨å†Œ/æ³¨å…¥ï¼‰é…ç½®çš„å‚æ•°æ¸…å•ä¸ä¸­æ–‡è¯´æ˜ï¼ŒæŒ‰ç±»åˆ†ç»„ã€‚è¡¨æ ¼åˆ—å‡ºå‚æ•°åã€é»˜è®¤å€¼ã€ç±»å‹ä¸ç®€çŸ­è¯´æ˜ï¼Œä»¥åŠåœ¨ INI ä¸­å¯æ¥å—çš„å†™æ³•ç¤ºä¾‹ã€‚

---

### å…±åŒ/ç›¸ä¼¼å‚æ•°ï¼ˆv1 ä¸ v2 éƒ½æœ‰ï¼‰

| å‚æ•° | é»˜è®¤ | ç±»å‹ | è¯´æ˜ | INI ç¤ºä¾‹ |
|---|---:|---|---|---|
| `gamma` | 0.3 | float | è¦†ç›–é¡¹ï¼ˆcoverageï¼‰ä¸ä¿¡æ¯é¡¹ï¼ˆinformationï¼‰èåˆæ—¶çš„æƒé‡ï¼ˆå½“æœªå¯ç”¨åŠ¨æ€ Î³_t æ—¶ä½¿ç”¨ï¼‰ | `gamma = 0.3` |
| `main_weight` | 0.5 | float | ä¸»æ•ˆåº”ï¼ˆmain effectï¼‰åœ¨ä¿¡æ¯èåˆä¸­çš„æƒé‡ | `main_weight = 0.5` |
| `pair_weight` | 1.0 | float | äº¤äº’é¡¹ï¼ˆpair interactionï¼‰åŸå§‹æƒé‡ï¼ˆÎ»_t æœªç¼©æ”¾æ—¶å‚è€ƒï¼‰ | `pair_weight = 1.0` |
| `use_dynamic_lambda` | True | bool | æ˜¯å¦å¯ç”¨åŸºäºå‚æ•°ä¸ç¡®å®šæ€§çš„åŠ¨æ€ Î»_tï¼ˆç”¨äºäº¤äº’æƒé‡éšè®­ç»ƒè¿›å±•è°ƒæ•´ï¼‰ | `use_dynamic_lambda = true` |
| `tau1` | 0.7 | float | åŠ¨æ€ Î»_t çš„é«˜é˜ˆå€¼ï¼ˆr_t > tau1 æ—¶åå‘ä¸»æ•ˆåº”ï¼‰ | `tau1 = 0.7` |
| `tau2` | 0.3 | float | åŠ¨æ€ Î»_t çš„ä½é˜ˆå€¼ï¼ˆr_t < tau2 æ—¶åé‡äº¤äº’ï¼‰ | `tau2 = 0.3` |
| `lambda_min` | 0.1 | float | åŠ¨æ€ Î» çš„æœ€å°å€¼ | `lambda_min = 0.1` |
| `lambda_max` | 1.0 | float | åŠ¨æ€ Î» çš„æœ€å¤§å€¼ | `lambda_max = 1.0` |
| `interaction_pairs` | None | list/str | æŒ‡å®šè¦è®¡ç®—çš„äº¤äº’å¯¹ã€‚å¯ä»¥æ˜¯å­—ç¬¦ä¸²æˆ–åºåˆ—ï¼Œæ”¯æŒå¤šç§åˆ†éš”æ ¼å¼ï¼ˆå¦‚ `"0,1;1,2"`ã€`"0|1"`ã€æˆ–çœŸæ­£çš„åˆ—è¡¨ï¼‰ã€‚ç¤ºä¾‹è§ä¸‹ã€‚ | `interaction_pairs = "0,1;2,3"` |
| `local_jitter_frac` | 0.1 | float | å±€éƒ¨æ‰°åŠ¨å°ºåº¦ï¼ŒæŒ‰è®­ç»ƒæ•°æ®èŒƒå›´çš„æ¯”ä¾‹å†³å®šæ‰°åŠ¨ Ïƒ | `local_jitter_frac = 0.1` |
| `local_num` | 4 | int | æ¯ç§æ‰°åŠ¨ç±»å‹çš„é‡‡æ ·æ•°ï¼ˆå±€åŸŸæ ·æœ¬æ•°ï¼‰ï¼Œå½±å“è®¡ç®—å¼€é”€ | `local_num = 4` |
| `variable_types` | None | dict | å¯ç›´æ¥ä¼ å…¥å­—å…¸ {index: "categorical"/"integer"/"continuous"}ï¼Œç”¨äºè¦†ç›–è‡ªåŠ¨æ¨æ–­ | å‚è§ä¸‹æ–‡ |
| `variable_types_list` | None | list æˆ– str | è¾ƒæ–¹ä¾¿çš„ INI å†™æ³•ï¼ŒæŒ‰ç»´åº¦é¡ºåºç»™å‡ºç±»å‹æ ‡è®°ï¼ˆå¦‚ `[categorical, integer, continuous,...]` æˆ– `"categorical, integer, continuous"`ï¼‰ | `variable_types_list = [categorical, integer, continuous, categorical, continuous, integer]` |
| `coverage_method` | "min_distance" | str | è¦†ç›–åº¦é‡æ–¹æ³•ï¼Œä¼ å…¥åº•å±‚ `compute_coverage_batch` çš„ method å‚æ•° | `coverage_method = min_distance` |
| `debug_components` | False | bool/str | æ‰“å¼€åä¼šæŠŠä¸­é—´åˆ†è§£é‡ï¼ˆä¸»/äº¤äº’/ä¿¡æ¯/è¦†ç›–ï¼‰ç¼“å­˜åˆ°å¯¹è±¡çš„å±æ€§ï¼Œä¾¿äºè°ƒè¯•/å¯¼å‡º | `debug_components = true` |

æ³¨æ„ï¼š`variable_types_list` ä¸ `variable_types` çš„ä¼˜å…ˆçº§ä¸ºï¼šæ˜ç¡®å®šä¹‰çš„ `variable_types` dict ä¼˜å…ˆï¼Œè‹¥æœªæä¾›åˆ™å°è¯•è§£æ `variable_types_list`ï¼ˆå­—ç¬¦ä¸²æˆ–åˆ—è¡¨æ ¼å¼ï¼‰ã€‚å¦‚æœäºŒè€…éƒ½ç¼ºå¤±ï¼Œç±»ä¼šå°è¯•ä»æ¨¡å‹ä¸­çš„ transforms è‡ªåŠ¨æ¨æ–­ï¼ˆè‹¥å¯ç”¨ï¼‰ã€‚

---

### v1ï¼š`EURAnovaPairAcqf` çš„ä¸“å±/é¢å¤–å‚æ•°

| å‚æ•° | é»˜è®¤ | è¯´æ˜ |
|---|---:|---|
| `coverage_method` | "min_distance" | è¦†ç›–è®¡ç®—æ–¹æ³•ï¼ˆåŒä¸Šï¼Œv1/v2 å…±ç”¨ï¼‰ |
| `local_num` | 4 | å±€éƒ¨æ‰°åŠ¨æ ·æœ¬æ•°ï¼ˆv1 ä¸ v2 ç›¸åŒï¼‰ |

v1 çš„å®ç°ä¸­ï¼Œå±€éƒ¨æ‰°åŠ¨ç”± `_make_local` äº§ç”Ÿï¼Œåˆ†ç±»/æ•´æ•°ç»´åº¦åœ¨ v1 ä¸­è¢«å½“ä½œè¿ç»­åŸŸæ‰°åŠ¨ï¼ˆå³ç”¨é«˜æ–¯æ‰°åŠ¨ï¼‰ã€‚è¿™åœ¨æ··åˆå˜é‡ç©ºé—´ä¼šäº§ç”Ÿä¸åˆæ³•çš„ç±»åˆ«å€¼ï¼Œå¯èƒ½éœ€è¦åœ¨å¤–å±‚é…ç½® `variable_types` å¹¶åœ¨ `PoolBasedGenerator` ä¸­ä¿è¯åˆæ³•æ€§ï¼Œæˆ–ç›´æ¥ä½¿ç”¨ v2 æ›¿ä»£ã€‚

---

### v2ï¼š`EURAnovaPairAcqf_v2` çš„ä¸“å±/æ–°å¢å‚æ•°

| å‚æ•° | é»˜è®¤ | ç±»å‹ | è¯´æ˜ |
|---|---:|---:|---|
| `use_dynamic_gamma` | True | bool | æ˜¯å¦å¯ç”¨åŠ¨æ€ Î³_tï¼ˆè¦†ç›–/ä¿¡æ¯èåˆæƒé‡éšè®­ç»ƒæ ·æœ¬æ•°/r_t è°ƒæ•´ï¼‰ |
| `gamma_max` | 0.5 | float | åŠ¨æ€ Î³ çš„ä¸Šç•Œï¼ˆè®­ç»ƒæ ·æœ¬å¾ˆå°æ—¶çš„åå¥½è¦†ç›–ï¼‰ |
| `gamma_min` | 0.1 | float | åŠ¨æ€ Î³ çš„ä¸‹ç•Œï¼ˆè®­ç»ƒæ ·æœ¬è¾ƒå¤šæ—¶çš„åå¥½ä¿¡æ¯ï¼‰ |
| `tau_n_min` | 3 | int | æ ·æœ¬æ•°ä¸‹é™é˜ˆå€¼ï¼ˆç”¨äº Î³_t åŠ¨æ€è®¡ç®—ï¼‰ |
| `tau_n_max` | 40 | int | æ ·æœ¬æ•°ä¸Šé™é˜ˆå€¼ï¼ˆç”¨äº Î³_t åŠ¨æ€è®¡ç®—ï¼‰ |

v2 çš„å…³é”®æ”¹è¿›æ˜¯ `_make_local_hybrid`ï¼šå¯¹äºåˆ†ç±»å˜é‡ç›´æ¥ä»è®­ç»ƒé›†çš„ unique å€¼é‡‡æ ·ï¼Œæ•´æ•°æ‰°åŠ¨åèˆå…¥å¹¶å¤¹å€¼ï¼Œè¿ç»­æŒ‰é«˜æ–¯æ‰°åŠ¨ï¼Œä»è€Œæ›´å¥½åœ°åŒ¹é…æ± ä¸­çœŸå®æ•°æ®åˆ†å¸ƒã€‚

---

### INI å†™æ³•å»ºè®®ä¸ç¤ºä¾‹

åœ¨ experiment çš„ INI ä¸­ï¼Œä½ å¯ä»¥åœ¨å¯¹åº”çš„ generator / acquisition section æŒ‡å®šè¿™äº›å‚æ•°ã€‚ä¾‹å¦‚ï¼š

```
[EURAnovaPairAcqf]
gamma = 0.25
main_weight = 0.4
pair_weight = 1.0
use_dynamic_lambda = true
tau1 = 0.8
tau2 = 0.2
lambda_min = 0.05
lambda_max = 1.0
interaction_pairs = "0,1;2,3"
local_jitter_frac = 0.08
local_num = 6
variable_types_list = [categorical, integer, continuous, categorical, continuous, integer]
debug_components = false
```

æˆ–é’ˆå¯¹ v2ï¼š

```
[EURAnovaPairAcqf_v2]
gamma = 0.3
use_dynamic_gamma = true
gamma_max = 0.6
gamma_min = 0.1
tau_n_min = 5
tau_n_max = 60
variable_types_list = categorical, integer, continuous, categorical, continuous, integer
```

æ³¨æ„ï¼šINI ä¸­çš„å­—ç¬¦ä¸²/åˆ—è¡¨è§£æåœ¨ `Config` å±‚ä¼šå°è¯•æŠŠ `variable_types_list` è§£æä¸ºå­—ç¬¦ä¸²æˆ–åºåˆ—ï¼ˆå®ç°é‡Œå¯¹å­—ç¬¦ä¸²åšäº†æ‹†åˆ†ï¼‰ã€‚è‹¥é‡åˆ°è§£æé—®é¢˜ï¼Œå¯ç›´æ¥åœ¨è¿è¡Œè„šæœ¬ä¸­æŠŠä¸€ä¸ª Python å­—å…¸æˆ–åˆ—è¡¨ä¼ é€’ç»™æ„é€ å‡½æ•°ã€‚

---

### è¯Šæ–­å»ºè®®ï¼ˆä¸ºä»€ä¹ˆä½ çš„ `data/*.csv` éœ€è¦æ­£ç¡®ç±»å‹å£°æ˜ï¼‰

- v1 å°†åˆ†ç±»/æ•´æ•°å½“ä½œè¿ç»­æ‰°åŠ¨æ—¶ï¼Œå±€éƒ¨æ‰°åŠ¨ä¼šäº§ç”Ÿä¸åˆæ³•çš„ç±»åˆ«å€¼ï¼ˆä¾‹å¦‚å¯¹å­—ç¬¦ä¸²ç±»åˆ«åš float é«˜æ–¯æ‰°åŠ¨ï¼‰ï¼Œè¿™ä¼šå¯¼è‡´å½“ä½ æŠŠæ± ï¼ˆpoolï¼‰ç‚¹ä¸ CSV è¡ŒåŒ¹é…æˆ–å°†ç¦»æ•£å€¼å›å¡«åˆ° `y` æ—¶å‡ºç°å¤§é‡ mismatchï¼Œä»è€Œè§¦å‘å›é€€é€»è¾‘ï¼ˆä¾‹å¦‚å°†æ‰€æœ‰æœªåŒ¹é…äº‹ä»¶å›å¡«ä¸º 3ï¼‰ã€‚
- v2 é€šè¿‡ `_make_local_hybrid` ä¿®å¤äº†è¿™ä¸€é—®é¢˜ï¼šåˆ†ç±»æŒ‰è®­ç»ƒé›† unique å€¼é‡‡æ ·ï¼Œæ•´æ•°æ‰°åŠ¨åèˆå…¥å¹¶æˆªæ–­ï¼Œè¿ç»­æŒ‰é«˜æ–¯æ‰°åŠ¨ï¼Œä»è€Œæ›´å¥½åœ°åŒ¹é…æ± ä¸­çœŸå®æ•°æ®åˆ†å¸ƒã€‚

å› æ­¤ï¼š

- å¯¹æ··åˆç±»å‹æ•°æ®å¼ºçƒˆå»ºè®®ä½¿ç”¨ `EURAnovaPairAcqf_v2`ï¼Œå¹¶åœ¨ INI ä¸­é€šè¿‡ `variable_types_list` æˆ– `variable_types` æ˜ç¡®å£°æ˜æ¯åˆ—çš„ç±»å‹ï¼ˆæˆ–ç¡®ä¿æ¨¡å‹çš„ transforms èƒ½è¢«æ¨æ–­å‡ºç±»å‹ï¼‰ã€‚
- å¦‚æœç»§ç»­ä½¿ç”¨ v1ï¼Œè¯·ç¡®ä¿æ•°æ®ä¸æ‰°åŠ¨/è¦†ç›–ç­–ç•¥ä¸€è‡´ï¼Œæˆ–æŠŠ `local_num` é™ä½ä»¥èŠ‚çœè®¡ç®—å¹¶å‡å°‘äº§ç”Ÿéæ³•å€¼çš„æ¦‚ç‡ã€‚

---

### æˆ‘å¯ä»¥ä¸ºä½ åšçš„æ”¹åŠ¨ï¼ˆå¯é€‰ï¼‰

1. åœ¨ `exp_test/*/config_v*.ini` ä¸­æŠŠ `variable_types_list` æ˜¾å¼å†™å¥½ï¼ˆæŒ‰ç…§ä½  CSV ä¸­æ¯åˆ—çš„çœŸå®ç±»å‹ï¼‰ï¼Œå¹¶æŠŠ generator çš„ `acqf` æŒ‡å‘ `EURAnovaPairAcqf_v2`ï¼ˆæ¨èï¼‰ï¼›
2. ä¿®æ”¹ `run_server.py` ä¸­çš„ pool åŠ è½½é€»è¾‘ï¼Œä½¿å…¶ä½¿ç”¨ pandas.Categorical / factorize æ¥ç¼–ç ç±»åˆ«ï¼Œé¿å… hash å¯¼è‡´çš„ä¸ä¸€è‡´ï¼›
3. æŠŠå›å¡«é€»è¾‘æ”¹ä¸ºå…ˆå°è¯•ç²¾ç¡®/è¿‘ä¼¼åŒ¹é…ï¼Œå†é‡‡ç”¨æœ€è¿‘é‚»å›é€€ï¼Œå¹¶ä¼˜å…ˆä½¿ç”¨ CSV ä¸­ `_y_cont`ï¼ˆè‹¥å­˜åœ¨ï¼‰æ¥ç¦»æ•£åŒ–æ ‡ç­¾ã€‚

å‘Šè¯‰æˆ‘ä½ è¦æˆ‘å…ˆåšå“ªä¸€æ­¥ï¼ˆæˆ‘å»ºè®®å…ˆæŠŠ `variable_types_list` æ˜ç¡®å¹¶åˆ‡æ¢åˆ° v2ï¼Œç„¶åæŠŠå›å¡«é€»è¾‘æ”¹ä¸º nearest-neighbor å›é€€å¹¶åˆ©ç”¨ `_y_cont`ï¼‰ï¼Œæˆ‘ä¼šæŒ‰æ­¥éª¤å®ç°å¹¶è¿è¡ŒéªŒè¯ã€‚

---

æ–‡ä»¶ä½ç½®ï¼š

- `extensions/dynamic_eur_acquisition/acquisition_function_anova.py`  (v1)
- `extensions/dynamic_eur_acquisition/acquisition_function_anova_v2.py` (v2)
- æœ¬ READMEï¼š`extensions/dynamic_eur_acquisition/README.md`

# Dynamic EUR Acquisition Function (V4)# Dynamic EUR Acquisition Function

ä¸€ä¸ªç”¨äºAEPsychæ¡†æ¶çš„è‡ªé€‚åº”é‡‡é›†å‡½æ•°ï¼Œä¸“é—¨ç”¨äºåˆ†ç±»å˜é‡å’Œæ··åˆç±»å‹å˜é‡çš„è´å¶æ–¯ä¼˜åŒ–ã€‚ä¸€ä¸ªç”¨äºåˆ†ç±»å˜é‡ä¸»åŠ¨å­¦ä¹ çš„åŠ¨æ€é‡‡é›†å‡½æ•°å®ç°ï¼Œä¸“æ³¨äºæœ€å¤§åŒ–ä¸»æ•ˆåº”å’Œäº¤äº’æ•ˆåº”ä¼°è®¡ç²¾åº¦ã€‚

## å¿«é€Ÿå¼€å§‹## é¡¹ç›®æ¦‚è¿°

### å®‰è£…æœ¬é¡¹ç›®å®ç°äº†ç”¨äº AEPsych æ¡†æ¶çš„è‡ªå®šä¹‰é‡‡é›†å‡½æ•°ï¼Œç‰¹åˆ«é’ˆå¯¹åˆ†ç±»å˜é‡çš„ä¸»åŠ¨å­¦ä¹ ä¼˜åŒ–ã€‚é€šè¿‡ç»“åˆå‚æ•°æ–¹å·®å‡å°‘ï¼ˆä¿¡æ¯å¢ç›Šï¼‰å’Œç©ºé—´è¦†ç›–ç­–ç•¥ï¼Œåœ¨æœ‰é™è¯•éªŒæ¬¡æ•°ä¸‹é«˜æ•ˆæ¢ç´¢è®¾è®¡ç©ºé—´

é¡¹ç›®ä¾èµ–å·²åŒ…å«åœ¨AEPsychä¸»é¡¹ç›®ä¸­ï¼š### ä¸»è¦ç›®æ ‡

```bash- **æœ€å¤§åŒ–ä¸»æ•ˆåº”ä¼°è®¡ç²¾åº¦**ï¼šé€šè¿‡ä¿¡æ¯å¢ç›Šä¼˜åŒ–ä¸»æ•ˆåº”çš„ä¼°è®¡

# ä½¿ç”¨pixiï¼ˆæ¨èï¼‰- **æœ€å¤§åŒ–äº¤äº’æ•ˆåº”ä¼°è®¡ç²¾åº¦**ï¼šç‰¹åˆ«å…³æ³¨äºŒé˜¶äº¤äº’æ•ˆåº”

pixi install- **æé«˜ç©ºé—´è¦†ç›–ç‡**ï¼šåœ¨æœ‰é™è¯•éªŒæ¬¡æ•°ä¸‹å°½å¯èƒ½è¦†ç›–è®¾è®¡ç©ºé—´

- **é¿å…é‡å¤é‡‡æ ·**ï¼šæé«˜æ¢ç´¢æ•ˆç‡

# æˆ–ä½¿ç”¨pip

pip install aepsych numpy scipy torch botorch## ç‰ˆæœ¬å†å²

```

### V1 - VarianceReductionWithCoverageAcqf (åŸºçº¿ç‰ˆæœ¬) âœ… **æ¨èä½¿ç”¨**

### åŸºæœ¬ä½¿ç”¨- **å®ç°æ–‡ä»¶**: `acquisition_function_v1.py`

- **æ ¸å¿ƒæ€æƒ³**: åŒç»„ä»¶è®¾è®¡ï¼ˆä¿¡æ¯å¢ç›Š + è¦†ç›–åº¦ï¼‰

```python- **ç‰¹ç‚¹**:

from extensions.dynamic_eur_acquisition import EURAcqfV4  - ä¿¡æ¯å¢ç›Šç»„ä»¶ï¼šæœ€å¤§åŒ–ä¸»æ•ˆåº”å’Œäº¤äº’æ•ˆåº”çš„æ–¹å·®å‡å°‘

from botorch.models import SingleTaskGP  - è¦†ç›–åº¦ç»„ä»¶ï¼šåŸºäºæœ€å°è·ç¦»çš„ç©ºé—´è¦†ç›–å¥–åŠ±

import torch  - åŠ¨æ€æƒé‡ï¼š`lambda_inter` ä» 0.5 â†’ 3.0 éšè¯•éªŒå¢åŠ 

- **æ€§èƒ½** (80 trials, 360 design space):

# 1. å‡†å¤‡è®­ç»ƒæ•°æ®  - å”¯ä¸€è®¾è®¡æ•°: 39/360 (10.8%)

train_X = torch.rand(20, 4)  # 20ä¸ªæ ·æœ¬ï¼Œ4ä¸ªç‰¹å¾  - å¹³å‡é‡å¤æ¬¡æ•°: 2.05x

train_Y = torch.rand(20, 1)  # 20ä¸ªè§‚æµ‹å€¼  - é«˜åˆ†è®¾è®¡ (â‰¥9.5): 8ä¸ª

  - å¹³å‡åˆ†æ•°: 8.72 Â± 0.89

# 2. è®­ç»ƒGPæ¨¡å‹- **ä¼˜åŠ¿**: ç®€å•ã€ç¨³å®šã€å¹³è¡¡è‰¯å¥½

model = SingleTaskGP(train_X, train_Y)- **ä¸è¶³**: å­˜åœ¨è½»å¾®é‡å¤é‡‡æ ·é—®é¢˜

model.train()

### V2 - EnhancedVarianceReductionAcqf (å®éªŒç‰ˆæœ¬) âš ï¸ **å¤±è´¥ - ä¸æ¨è**

# 3. åˆ›å»ºé‡‡é›†å‡½æ•°- **å®ç°æ–‡ä»¶**: `acquisition_function_v2.py`

acqf = EURAcqfV4(- **æ”¹è¿›æªæ–½**:

    model=model,  1. é‡å¤æƒ©ç½šæœºåˆ¶ (`penalty_repeat=0.01`)

    lambda_min=0.2,  2. åŠ¨æ€å¤šæ ·æ€§æƒé‡ (`gamma_diversity: 0.8â†’0.2`)

    lambda_max=2.0,  3. åˆ†ç®±å‡åŒ€æ€§ç®¡ç† (`gamma_binning=0.4`, `n_bins=5`)

    tau_1=0.5,  4. åŠ¨æ€äº¤äº’æƒé‡å¢å¼º (`lambda_inter: 0.5â†’3.0`)

    tau_2=0.1,  5. UCB æ¢ç´¢å¥–åŠ± (`beta_ucb=0.15`)

    gamma=0.3,  6. ä¿¡æ¯å¢ç›Šä¼˜å…ˆä¼˜åŒ–

    interaction_terms=[(0, 1), (1, 2), (2, 3)],  # æŒ‡å®šå…³æ³¨çš„äº¤äº’é¡¹- **æ€§èƒ½** (80 trials, 360 design space):

    variable_types={0: "categorical", 1: "categorical", 2: "integer", 3: "continuous"}  - å”¯ä¸€è®¾è®¡æ•°: 28/360 (7.8%) âŒ **æ¯” V1 å·® 28.2%**

)  - å¹³å‡é‡å¤æ¬¡æ•°: 2.86x âŒ **æ¯” V1 å¤š 39.5%**

  - é«˜åˆ†è®¾è®¡ (â‰¥9.5): 4ä¸ª âŒ **æ¯” V1 å°‘ 50.0%**

# 4. åœ¨LHSååˆå§‹åŒ–ï¼ˆè·å–åˆå§‹æ–¹å·®åŸºçº¿ï¼‰  - å¹³å‡åˆ†æ•°: 7.94 Â± 0.60 âŒ **æ¯” V1 ä½ 0.78 åˆ†**

acqf.initialize_after_lhs(train_X, train_Y)- **å¤±è´¥åŸå› **:

  1. é‡å¤æƒ©ç½šè¿‡å¼±ï¼ˆåº”ä½¿ç”¨ç¡¬æ’é™¤ `-inf`ï¼‰

# 5. è¯„ä¼°å€™é€‰ç‚¹  2. åˆ†ç®±ç®¡ç†äº§ç”Ÿå±€éƒ¨é™·é˜±

candidates = torch.rand(10, 4)  # 10ä¸ªå€™é€‰ç‚¹  3. å¤šç»„ä»¶å¹³è¡¡å¤æ‚åº¦è¿‡é«˜ï¼ˆ4ç»„ä»¶ vs V1çš„2ç»„ä»¶ï¼‰

scores = acqf(candidates)  4. åŠ¨æ€å¤šæ ·æ€§æƒé‡å‡å°å¯¼è‡´è¿‡åº¦å¼€å‘

best_idx = scores.argmax()- **æ•™è®­**: 

next_point = candidates[best_idx]  - ç®€å•ä¼˜äºå¤æ‚

```  - ç¡¬çº¦æŸä¼˜äºè½¯æƒ©ç½š

  - V1 çš„è®¾è®¡å·²ç»å¾ˆä¼˜ç§€ï¼Œæ— éœ€å…¨é¢é‡æ„

### åœ¨AEPsyché…ç½®ä¸­ä½¿ç”¨

### V3 - æ¨èæ–¹å‘ (æœªå®ç°)

```ini- **å»ºè®®**: æœ€å°åŒ–æ”¹åŠ¨ï¼Œä¿æŒ V1 æ¡†æ¶

[common]- **å”¯ä¸€æ”¹å˜**: æ·»åŠ ç¡¬é‡å¤æ’é™¤

parnames = [color, layout, font_size, background]  ```python

stimuli_per_trial = 1  if design_key in sampled_designs:

outcome_types = [continuous]      score = -np.inf  # ç¡¬æ’é™¤ï¼Œéè½¯æƒ©ç½š

strategy_names = [init_strat, opt_strat]  ```

- **å¯é€‰**: å€™é€‰é›†é¢„è¿‡æ»¤ï¼ˆ80%æœªé‡‡æ · + 20%å·²é‡‡æ ·ï¼‰

[color]- **é¢„æœŸæ€§èƒ½**: 55-65 å”¯ä¸€è®¾è®¡ (+40-65%), 12-16 é«˜åˆ†è®¾è®¡ (+50-100%)

par_type = categorical

choices = [red, blue, green, yellow]## é¡¹ç›®ç»“æ„



[layout]```

par_type = categorical  dynamic_eur_acquisition/

choices = [grid, list, flow]â”œâ”€â”€ acquisition_function_v1.py          # V1 åŸºçº¿ç‰ˆæœ¬ âœ… æ¨è

â”œâ”€â”€ acquisition_function_v2.py          # V2 å®éªŒç‰ˆæœ¬ âš ï¸ å¤±è´¥

[font_size]â”œâ”€â”€ gower_distance.py                   # Gower è·ç¦»è®¡ç®—ï¼ˆæ··åˆå˜é‡ï¼‰

par_type = integerâ”œâ”€â”€ gp_variance.py                      # GP æ–¹å·®è®¡ç®—å™¨

lower_bound = 10â”œâ”€â”€ __init__.py

upper_bound = 20â”‚

â”œâ”€â”€ test/

[background]â”‚   â””â”€â”€ categorical_experiment/

par_type = continuousâ”‚       â”œâ”€â”€ experiment_config_v1.ini    # V1 é…ç½®

lower_bound = 0.0â”‚       â”œâ”€â”€ experiment_config_v2.ini    # V2 é…ç½®

upper_bound = 1.0â”‚       â”œâ”€â”€ run_categorical_experiment_v1.py  # V1 å®éªŒè„šæœ¬

â”‚       â”œâ”€â”€ run_categorical_experiment_v2.py  # V2 å®éªŒè„šæœ¬

[init_strat]â”‚       â”œâ”€â”€ compare_v1_vs_v2.py         # V1/V2 å¯¹æ¯”åˆ†æ

min_asks = 20â”‚       â”œâ”€â”€ results/                    # V1 å®éªŒç»“æœ

generator = SobolGeneratorâ”‚       â”œâ”€â”€ results_v2/                 # V2 å®éªŒç»“æœ

â”‚       â”œâ”€â”€ report/                     # åˆ†ææŠ¥å‘Šå’Œå¯è§†åŒ–

[opt_strat]â”‚       â”‚   â”œâ”€â”€ comparison_v1_vs_v2.png # 8 é¢æ¿å¯¹æ¯”å›¾è¡¨

min_asks = 50â”‚       â”‚   â””â”€â”€ V2_FAILURE_ANALYSIS.md  # V2 å¤±è´¥åˆ†æ

generator = OptimizeAcqfGeneratorâ”‚       â””â”€â”€ FINAL_REPORT_V2.md          # å®Œæ•´å®éªŒæ€»ç»“

acqf = EURAcqfV4â”‚

â”œâ”€â”€ docs/                               # åŸå§‹æ–‡æ¡£

[EURAcqfV4]â”‚   â”œâ”€â”€ README.md

lambda_min = 0.2â”‚   â”œâ”€â”€ QUICKSTART.md

lambda_max = 2.0â”‚   â””â”€â”€ IMPLEMENTATION_SUMMARY.md

tau_1 = 0.5â”‚

tau_2 = 0.1â”œâ”€â”€ README.md                           # æœ¬æ–‡ä»¶ï¼ˆé¡¹ç›®æ€»è§ˆï¼‰

gamma = 0.3â””â”€â”€ .gitignore                          # Git å¿½ç•¥é…ç½®

interaction_terms = (0,1);(1,2);(2,3)```

coverage_method = min_distance

# variable_typesè‡ªåŠ¨ä»ParameterTransformsæ¨æ–­## å¿«é€Ÿå¼€å§‹

```

### å®‰è£…ä¾èµ–

## æ ¸å¿ƒç‰¹æ€§

```bash

### 1. è‡ªé€‚åº”ä¿¡æ¯å¢ç›Š# ä½¿ç”¨ pixiï¼ˆæ¨èï¼‰

- **ä¸»æ•ˆåº”æ¢ç´¢**: ä¼˜å…ˆæ¢ç´¢å¯¹å“åº”å½±å“å¤§çš„ä¸»è¦å› ç´ pixi install

- **äº¤äº’æ•ˆåº”æ¢ç´¢**: åŠ¨æ€å¢åŠ äº¤äº’é¡¹çš„æ¢ç´¢æƒé‡

- **åŠ¨æ€å¹³è¡¡**: Î»_tæ ¹æ®ä¸»æ•ˆåº”ä¸ç¡®å®šæ€§è‡ªåŠ¨è°ƒæ•´# æˆ–ä½¿ç”¨ pip

pip install numpy scipy matplotlib aepsych

### 2. ç©ºé—´è¦†ç›–ä¼˜åŒ–```

- **Gowerè·ç¦»**: æ”¯æŒæ··åˆç±»å‹å˜é‡ï¼ˆåˆ†ç±»ã€æ•´æ•°ã€è¿ç»­ï¼‰

- **è‡ªé€‚åº”è¦†ç›–**: é¿å…è¿‡åº¦é‡‡æ ·åŒä¸€åŒºåŸŸ### ä½¿ç”¨ V1 é‡‡é›†å‡½æ•°ï¼ˆæ¨èï¼‰

- **ç¡¬æ’é™¤**: è‡ªåŠ¨æ’é™¤å·²é‡‡æ ·çš„é‡å¤è®¾è®¡ç‚¹

```python

### 3. å˜é‡ç±»å‹æ„ŸçŸ¥from acquisition_function_v1 import VarianceReductionWithCoverageAcqf

- **è‡ªåŠ¨æ¨æ–­**: ä»AEPsychçš„ParameterTransformsè‡ªåŠ¨è¯†åˆ«å˜é‡ç±»å‹import numpy as np

- **è§„èŒƒåŒ–å¤„ç†**: åˆ†ç±»å’Œæ•´æ•°å˜é‡è‡ªåŠ¨roundåˆ°æœ‰æ•ˆå€¼

- **çµæ´»é…ç½®**: æ”¯æŒæ‰‹åŠ¨æŒ‡å®švariable_types# åˆå§‹åŒ–é‡‡é›†å‡½æ•°

acq_fn = VarianceReductionWithCoverageAcqf(

## ä¸»è¦å‚æ•°    lambda_main=1.0,         # ä¸»æ•ˆåº”æƒé‡

    lambda_inter=0.5,        # äº¤äº’æ•ˆåº”åˆå§‹æƒé‡

| å‚æ•° | ç±»å‹ | é»˜è®¤å€¼ | è¯´æ˜ |    lambda_inter_max=3.0,    # äº¤äº’æ•ˆåº”æœ€å¤§æƒé‡

|------|------|--------|------|    tau_main=0.3,            # ä¸»æ•ˆåº”é˜ˆå€¼

| `lambda_min` | float | 0.2 | äº¤äº’é¡¹æƒé‡æœ€å°å€¼ |    tau_inter=0.5,           # äº¤äº’æ•ˆåº”é˜ˆå€¼

| `lambda_max` | float | 2.0 | äº¤äº’é¡¹æƒé‡æœ€å¤§å€¼ |    gamma_diversity=0.5,     # å¤šæ ·æ€§/è¦†ç›–åº¦æƒé‡

| `tau_1` | float | 0.5 | ä¸»æ•ˆåº”é˜ˆå€¼ï¼ˆr_tçš„ä¸­ç‚¹ï¼‰ |    interaction_terms=[(0, 1), (1, 3), (2, 3)]  # å…³æ³¨çš„äº¤äº’é¡¹

| `tau_2` | float | 0.1 | ä¸»æ•ˆåº”é˜ˆå€¼å®½åº¦ |)

| `gamma` | float | 0.3 | è¦†ç›–åº¦æƒé‡ |

| `interaction_terms` | List[Tuple] | [] | å…³æ³¨çš„äº¤äº’é¡¹ï¼Œå¦‚[(0,1), (2,3)] |# æ‹Ÿåˆæ•°æ®

| `noise_variance` | float | 1.0 | GPå™ªå£°æ–¹å·® |X_train = np.array([[0, 1, 2, 0], [1, 0, 1, 2]])  # ç¤ºä¾‹æ•°æ®

| `prior_variance` | float | 1.0 | GPå…ˆéªŒæ–¹å·® |y_train = np.array([0.8, 0.6])

| `variable_types` | Dict | None | å˜é‡ç±»å‹æ˜ å°„ï¼Œå¦‚{0: "categorical"} |acq_fn.fit(X_train, y_train)

| `coverage_method` | str | "min_distance" | è¦†ç›–åº¦è®¡ç®—æ–¹æ³• |

# è¯„ä¼°å€™é€‰ç‚¹

## æ•°å­¦åŸç†X_candidates = np.array([[0, 0, 0, 0], [1, 1, 1, 1]])

scores = acq_fn(X_candidates)

é‡‡é›†å‡½æ•°ç»“åˆäº†ä¸¤ä¸ªç»„ä»¶ï¼šbest_idx = np.argmax(scores)

```

**Î±(x; D_t) = Î±_info(x; D_t) + Î³ Â· Î±_cov(x; D_t)**

### è¿è¡Œå®Œæ•´å®éªŒ

### ä¿¡æ¯å¢ç›Šç»„ä»¶ (Î±_info)

**V1 åŸºçº¿å®éªŒ** (æ¨è):

``````bash

Î±_info = (1/|J|) Î£_{jâˆˆJ} Î”Var[Î¸_j | x] + Î»_t Â· (1/|I|) Î£_{(j,k)âˆˆI} Î”Var[Î¸_jk | x]cd test/categorical_experiment

```pixi run python run_categorical_experiment_v1.py

```

- **ä¸»æ•ˆåº”é¡¹**: å¹³å‡æ¯ä¸ªä¸»æ•ˆåº”å‚æ•°çš„æ–¹å·®å‡å°‘

- **äº¤äº’æ•ˆåº”é¡¹**: å¹³å‡æ¯ä¸ªäº¤äº’æ•ˆåº”å‚æ•°çš„æ–¹å·®å‡å°‘ï¼Œæƒé‡Î»_tåŠ¨æ€è°ƒæ•´**V2 å®éªŒ** (ä»…ç”¨äºç ”ç©¶å¯¹æ¯”):

```bash

### åŠ¨æ€æƒé‡ (Î»_t)cd test/categorical_experiment

pixi run python run_categorical_experiment_v2.py

``````

Î»_t = Î»_min + (Î»_max - Î»_min) Â· sigmoid((r_t - Ï„_1) / Ï„_2)

```### å¯¹æ¯”åˆ†æ



å…¶ä¸­ `r_t` æ˜¯ä¸»æ•ˆåº”ç›¸å¯¹ä¸ç¡®å®šæ€§ï¼š```bash

cd test/categorical_experiment

```pixi run python compare_v1_vs_v2.py

r_t = mean(Var[Î¸_j | D_t] / Var[Î¸_j | D_0])```

```

## é…ç½®è¯´æ˜

- **æ—©æœŸé˜¶æ®µ** (r_t â‰ˆ 1): Î»_t â‰ˆ Î»_minï¼Œä¾§é‡ä¸»æ•ˆåº”

- **åæœŸé˜¶æ®µ** (r_t â†’ 0): Î»_t â†’ Î»_maxï¼Œä¾§é‡äº¤äº’æ•ˆåº”### V1 å…³é”®å‚æ•°ï¼ˆAEPsych é…ç½®æ ¼å¼ï¼‰

### è¦†ç›–åº¦ç»„ä»¶ (Î±_cov)```ini

[common]

```parnames = [color, layout, font_size, background]

Î±_cov(x; D_t) = min_{x'âˆˆD_t} d_Gower(x, x')stimuli_per_trial = 1

```outcome_types = [continuous]

strategy_names = [init_strat, opt_strat]

ä½¿ç”¨Gowerè·ç¦»è¡¡é‡åˆ°å·²é‡‡æ ·ç‚¹çš„æœ€å°è·ç¦»ï¼Œé¼“åŠ±æ¢ç´¢æœªè¦†ç›–åŒºåŸŸã€‚

[opt_strat]

## é¡¹ç›®ç»“æ„generator = OptimizeAcqfGenerator

model = GPClassificationModel

```acqf = VarianceReductionWithCoverageAcqf

dynamic_eur_acquisition/

â”œâ”€â”€ acquisition_function_v4.py      # V4ä¸»å®ç° âœ…[VarianceReductionWithCoverageAcqf]

â”œâ”€â”€ gower_distance.py               # Gowerè·ç¦»è®¡ç®—lambda_main = 1.0               # ä¸»æ•ˆåº”æƒé‡

â”œâ”€â”€ gp_variance.py                  # GPæ–¹å·®è®¡ç®—lambda_inter = 0.5              # äº¤äº’æ•ˆåº”åˆå§‹æƒé‡

â”œâ”€â”€ __init__.py                     # åŒ…å¯¼å…¥lambda_inter_max = 3.0          # äº¤äº’æ•ˆåº”æœ€å¤§æƒé‡

â”œâ”€â”€ README.md                       # æœ¬æ–‡ä»¶tau_main = 0.3                  # ä¸»æ•ˆåº”é˜ˆå€¼

â”‚tau_inter = 0.5                 # äº¤äº’æ•ˆåº”é˜ˆå€¼

â”œâ”€â”€ configs/                        # é…ç½®ç¤ºä¾‹gamma_diversity = 0.5           # å¤šæ ·æ€§/è¦†ç›–åº¦æƒé‡

â”‚   â”œâ”€â”€ config_example.inicoverage_method = min_distance  # è¦†ç›–åº¦è®¡ç®—æ–¹æ³•

â”‚   â”œâ”€â”€ config_template.iniinteraction_terms = (0,1);(1,3);(2,3)  # å…³æ³¨çš„äº¤äº’é¡¹

â”‚   â””â”€â”€ simulation_config.ini```

â”‚

â”œâ”€â”€ docs/                           # è¯¦ç»†æ–‡æ¡£### V2 é¢å¤–å‚æ•° (ä¸æ¨èä½¿ç”¨)

â”‚   â”œâ”€â”€ README.md

â”‚   â”œâ”€â”€ QUICKSTART.md```ini

â”‚   â””â”€â”€ IMPLEMENTATION_SUMMARY.mdpenalty_repeat = 0.01           # é‡å¤æƒ©ç½šï¼ˆå¤ªå¼±ï¼Œæ•ˆæœä¸ä½³ï¼‰

â”‚gamma_binning = 0.4             # åˆ†ç®±ç®¡ç†ï¼ˆé€ æˆå±€éƒ¨é™·é˜±ï¼‰

â”œâ”€â”€ test/                           # æµ‹è¯•å’Œç¤ºä¾‹n_bins = 5                      # åˆ†ç®±æ•°é‡

â”‚   â”œâ”€â”€ unit_tests/                 # å•å…ƒæµ‹è¯•beta_ucb = 0.15                 # UCB æ¢ç´¢

â”‚   â”œâ”€â”€ integration_tests/          # é›†æˆæµ‹è¯•gamma_exploration = 0.3         # æ¢ç´¢å¥–åŠ±æƒé‡

â”‚   â”œâ”€â”€ examples/                   # ä½¿ç”¨ç¤ºä¾‹gamma_diversity_min = 0.2       # å¤šæ ·æ€§æœ€å°æƒé‡

â”‚   â””â”€â”€ simulation_project/         # ä»¿çœŸé¡¹ç›®```

â”‚

â”œâ”€â”€ legacy/                         # å†å²ç‰ˆæœ¬ï¼ˆV1-V3ï¼‰## å®éªŒç»“æœå¯¹æ¯”

â”‚   â”œâ”€â”€ acquisition_function.py     # V1

â”‚   â”œâ”€â”€ acquisition_function_v2.py  # V2### æ€§èƒ½æŒ‡æ ‡å¯¹æ¯”è¡¨

â”‚   â”œâ”€â”€ acquisition_function_v3.py  # V3

â”‚   â””â”€â”€ hard_exclusion_generator.py| æŒ‡æ ‡ | V1 (åŸºçº¿) âœ… | V2 (å®éªŒ) âš ï¸ | å˜åŒ– |

â”‚|------|-----------|-----------|------|

â””â”€â”€ archive/                        # å†å²æ–‡æ¡£å’ŒæŠ¥å‘Š| **å”¯ä¸€è®¾è®¡æ•°** | 39/360 (10.8%) | 28/360 (7.8%) | **-28.2%** âŒ |

    â”œâ”€â”€ docs/                       # å®Œæ•´å†å²æ–‡æ¡£| **å¹³å‡é‡å¤æ¬¡æ•°** | 2.05x | 2.86x | **+39.5%** âŒ |

    â””â”€â”€ configs/                    # æ—§é…ç½®æ–‡ä»¶| **é«˜åˆ†è®¾è®¡ (â‰¥9.5)** | 8 ä¸ª | 4 ä¸ª | **-50.0%** âŒ |

```| **å¹³å‡åˆ†æ•°** | 8.72Â±0.89 | 7.94Â±0.60 | **-0.78** âŒ |

| **ç»„ä»¶æ•°é‡** | 2 | 4 | +100% |

## æ ¸å¿ƒæ–‡ä»¶| **ä»£ç è¡Œæ•°** | ~500 | ~850 | +70% |

| **å‚æ•°æ•°é‡** | 11 | 17 | +55% |

ä½¿ç”¨V4åªéœ€è¦ä»¥ä¸‹æ–‡ä»¶ï¼š

### è¯¦ç»†åˆ†æ

1. **acquisition_function_v4.py** - ä¸»é‡‡é›†å‡½æ•°ç±»

2. **gower_distance.py** - è·ç¦»è®¡ç®—å·¥å…·æŸ¥çœ‹å®Œæ•´çš„å®éªŒåˆ†ææŠ¥å‘Šï¼š

3. **gp_variance.py** - æ–¹å·®ä¼°è®¡å·¥å…·- **å¤±è´¥åˆ†æ**: `test/categorical_experiment/report/V2_FAILURE_ANALYSIS.md`

4. **__init__.py** - åŒ…å¯¼å…¥- **å®Œæ•´æŠ¥å‘Š**: `test/categorical_experiment/FINAL_REPORT_V2.md`

- **å¯è§†åŒ–å¯¹æ¯”**: `test/categorical_experiment/report/comparison_v1_vs_v2.png`

## æµ‹è¯•

## å…³é”®å‘ç°ä¸æ•™è®­

```bash

# è¿è¡Œå•å…ƒæµ‹è¯•### âœ… æˆåŠŸç»éªŒ (æ¥è‡ª V1)

cd test/unit_tests

pixi run python -m pytest test_acquisition_v4.py1. **ç®€å•å³ç¾**: åŒç»„ä»¶è®¾è®¡ï¼ˆä¿¡æ¯å¢ç›Š + è¦†ç›–åº¦ï¼‰è¶³å¤Ÿæœ‰æ•ˆ

2. **ç¨³å®šæƒé‡**: å›ºå®šçš„å¤šæ ·æ€§æƒé‡ï¼ˆ0.5ï¼‰ä¼˜äºåŠ¨æ€è°ƒæ•´

# è¿è¡Œé›†æˆæµ‹è¯•3. **æ¸è¿›ç­–ç•¥**: äº¤äº’æ•ˆåº”æƒé‡åŠ¨æ€å¢åŠ ï¼ˆ0.5â†’3.0ï¼‰ç¬¦åˆå­¦ä¹ è¿‡ç¨‹

cd test/integration_tests4. **æœ€å°è·ç¦»è¦†ç›–**: æœ‰æ•ˆé˜²æ­¢å±€éƒ¨è¿‡é‡‡æ ·

pixi run python test_full_workflow.py

### âŒ å¤±è´¥æ•™è®­ (æ¥è‡ª V2)

# è¿è¡Œç¤ºä¾‹

cd test/examples1. **è¿‡åº¦è®¾è®¡**: æ·»åŠ è¿‡å¤šç»„ä»¶å¢åŠ è°ƒå‚å¤æ‚åº¦è€Œæ— å®è´¨æ”¶ç›Š

pixi run python example_basic_usage.py2. **è½¯æƒ©ç½šå¤±æ•ˆ**: 0.01 çš„é‡å¤æƒ©ç½šæ— æ³•æœ‰æ•ˆé˜»æ­¢é‡å¤é‡‡æ ·

```3. **åˆ†ç®±é™·é˜±**: åˆ†ç®±ç®¡ç†å¯¼è‡´åœ¨ä¸­åˆ†åŒºåŸŸçš„è¿‡åº¦é‡‡æ ·

4. **åŠ¨æ€æƒé‡é£é™©**: å¤šæ ·æ€§æƒé‡ä» 0.8 é™åˆ° 0.2 å¯¼è‡´åæœŸè¿‡åº¦å¼€å‘

## æ€§èƒ½ç‰¹ç‚¹

### ğŸ’¡ æ ¸å¿ƒè§è§£

- **è®¡ç®—æ•ˆç‡**: æ‰¹é‡è¯„ä¼°å€™é€‰ç‚¹ï¼Œæ”¯æŒGPUåŠ é€Ÿ

- **å†…å­˜ä¼˜åŒ–**: å¢é‡æ›´æ–°æ–¹å·®åŸºçº¿ï¼Œé¿å…é‡å¤è®¡ç®—- **é—®é¢˜è¯Šæ–­**: V1 çš„å”¯ä¸€é—®é¢˜æ˜¯é‡å¤é‡‡æ ·ï¼Œä¸æ˜¯è®¾è®¡æ¡†æ¶æœ¬èº«

- **å¯æ‰©å±•æ€§**: æ”¯æŒé«˜ç»´é—®é¢˜ï¼ˆæµ‹è¯•åˆ°20+ç»´åº¦ï¼‰- **è§£å†³æ–¹æ¡ˆ**: åº”ä½¿ç”¨ç¡¬æ’é™¤ï¼ˆ`-inf`ï¼‰ï¼Œè€Œéæ·»åŠ å¤æ‚æœºåˆ¶

- **è®¾è®¡å“²å­¦**: é’ˆå¯¹æ€§ä¿®å¤ä¼˜äºå…¨é¢é‡æ„

## ç‰ˆæœ¬å†å²- **å®éªŒä»·å€¼**: è´Ÿé¢ç»“æœä¹Ÿæ˜¯å®è´µçš„çŸ¥è¯† - "The only real mistake is the one from which we learn nothing."



- **V4** (å½“å‰): forward-onlyè®¾è®¡ï¼Œå˜é‡ç±»å‹æ„ŸçŸ¥ï¼Œç©ºé—´è§„èŒƒåŒ– âœ… **æ¨èä½¿ç”¨**## æ•°å­¦å…¬å¼

- **V3**: ç¡¬æ’é™¤ + ç»„åˆç­–ç•¥ï¼ˆè§`legacy/`ï¼‰

- **V2**: å¢å¼ºç‰ˆè½¯æƒ©ç½šï¼ˆè§`legacy/`ï¼‰### V1 é‡‡é›†å‡½æ•°

- **V1**: åŸºçº¿ç‰ˆæœ¬ï¼ˆè§`legacy/`ï¼‰

**Î±(x; D_t) = Î±_info(x; D_t) + Î±_cov(x; D_t)**

è¯¦ç»†çš„ç‰ˆæœ¬å¯¹æ¯”å’Œå†å²åˆ†æè§ `archive/docs/README_FULL_HISTORY.md`

å…¶ä¸­ï¼š

## ç›¸å…³æ–‡æ¡£

- **Î±_info**: ä¿¡æ¯å¢ç›Šé¡¹

- **å¿«é€Ÿå…¥é—¨**: `docs/QUICKSTART.md`  - Î±_info = (1/|J|) Î£_j Î”Var[Î¸_j] + Î»_t(r_t) Ã— (1/|I|) Î£_{j,k} Î”Var[Î¸_jk]

- **APIæ–‡æ¡£**: `docs/README.md`  - ä¸»æ•ˆåº” + åŠ¨æ€åŠ æƒçš„äº¤äº’æ•ˆåº”

- **å®ç°ç»†èŠ‚**: `docs/IMPLEMENTATION_SUMMARY.md`  

- **å®Œæ•´å†å²**: `archive/docs/README_FULL_HISTORY.md`- **Î±_cov**: ç©ºé—´è¦†ç›–é¡¹  

  - Î±_cov = Î³ Ã— COV(x; D_t)

## å¸¸è§é—®é¢˜  - åŸºäº Gower è·ç¦»åˆ°ç°æœ‰æ ·æœ¬

  - ä½¿ç”¨ min_distance æ–¹æ³•

### Q: å¦‚ä½•é€‰æ‹©interaction_termsï¼Ÿ

- **Î»_t(r_t)**: åŠ¨æ€æƒé‡å‡½æ•°

A: åŸºäºé¢†åŸŸçŸ¥è¯†é€‰æ‹©å¯èƒ½æœ‰äº¤äº’æ•ˆåº”çš„å› ç´ å¯¹ã€‚å¦‚æœä¸ç¡®å®šï¼Œå¯ä»¥ï¼š  - éšç€ä¸»æ•ˆåº”ä¸ç¡®å®šæ€§é™ä½ï¼Œå¢åŠ äº¤äº’æ•ˆåº”æƒé‡

- ä»æ‰€æœ‰ä¸¤ä¸¤ç»„åˆå¼€å§‹: `[(i,j) for i in range(n) for j in range(i+1, n)]`  - åˆ†æ®µçº¿æ€§å‡½æ•°ï¼Œä¾èµ–ç›¸å¯¹æ–¹å·® r_t

- æˆ–å…ˆæ¢ç´¢ä¸»æ•ˆåº”ï¼Œå†æ ¹æ®ç»“æœæ·»åŠ äº¤äº’é¡¹

### V2 é‡‡é›†å‡½æ•°ï¼ˆä¸æ¨èï¼‰

### Q: variable_typeså¿…é¡»æ‰‹åŠ¨æŒ‡å®šå—ï¼Ÿ

**Î±(x; D_t) = w_info Ã— Î±_info + w_div Ã— Î±_div + w_bin Ã— Î±_bin + w_expl Ã— Î±_expl**

A: ä¸éœ€è¦ã€‚V4ä¼šè‡ªåŠ¨ä»AEPsychçš„ParameterTransformsæ¨æ–­å˜é‡ç±»å‹ã€‚åªæœ‰åœ¨ç›´æ¥ä½¿ç”¨ï¼ˆä¸é€šè¿‡AEPsyché…ç½®ï¼‰æ—¶æ‰éœ€è¦æ‰‹åŠ¨æŒ‡å®šã€‚

å…¶ä¸­æ·»åŠ äº†åˆ†ç®±ç®¡ç†å’Œæ¢ç´¢å¥–åŠ±ï¼Œä½†å¢åŠ äº†å¤æ‚åº¦ä¸”æ•ˆæœä¸ä½³ã€‚

### Q: å¦‚ä½•è°ƒæ•´æ¢ç´¢vså¼€å‘çš„å¹³è¡¡ï¼Ÿ

## å‚æ•°è¯´æ˜

A: è°ƒæ•´ä»¥ä¸‹å‚æ•°ï¼š

- `gamma`: å¢å¤§æé«˜ç©ºé—´è¦†ç›–ï¼ˆæ¢ç´¢ï¼‰ï¼Œå‡å°æé«˜ä¿¡æ¯å¢ç›Šï¼ˆå¼€å‘ï¼‰### V1 å…³é”®å‚æ•°

- `lambda_min/max`: æ§åˆ¶äº¤äº’æ•ˆåº”æ¢ç´¢çš„åŠ¨æ€èŒƒå›´

- `tau_1/tau_2`: è°ƒæ•´ä»ä¸»æ•ˆåº”åˆ°äº¤äº’æ•ˆåº”çš„è½¬æ¢æ—¶æœº| å‚æ•° | æè¿° | é»˜è®¤å€¼ | èŒƒå›´ |

|------|------|--------|------|

### Q: æ”¯æŒçº¦æŸä¼˜åŒ–å—ï¼Ÿ| `lambda_main` | ä¸»æ•ˆåº”æƒé‡ | 1.0 | [0, âˆ) |

| `lambda_inter` | äº¤äº’æ•ˆåº”åˆå§‹æƒé‡ | 0.5 | [0, âˆ) |

A: V4æœ¬èº«ä¸å¤„ç†çº¦æŸï¼Œä½†å¯ä»¥é€šè¿‡ï¼š| `lambda_inter_max` | äº¤äº’æ•ˆåº”æœ€å¤§æƒé‡ | 3.0 | [lambda_inter, âˆ) |

- é¢„è¿‡æ»¤å€™é€‰é›†ï¼ˆåœ¨ç”Ÿæˆcandidatesæ—¶æ’é™¤ä¸å¯è¡Œç‚¹ï¼‰| `tau_main` | ä¸»æ•ˆåº”æ–¹å·®é˜ˆå€¼ | 0.3 | [0, 1.0] |

- ä½¿ç”¨AEPsychçš„çº¦æŸå¤„ç†æœºåˆ¶| `tau_inter` | äº¤äº’æ•ˆåº”æ–¹å·®é˜ˆå€¼ | 0.5 | [0, 1.0] |

- åå¤„ç†ï¼šå°†ä¸å¯è¡Œç‚¹çš„åˆ†æ•°è®¾ä¸º`-inf`| `gamma_diversity` | è¦†ç›–åº¦æƒé‡ | 0.5 | [0, âˆ) |

| `coverage_method` | è¦†ç›–åº¦è®¡ç®—æ–¹æ³• | 'min_distance' | min/mean/median |

## å¼•ç”¨| `interaction_terms` | äº¤äº’é¡¹åˆ—è¡¨ | [] | [(i,j), ...] |



å¦‚æœåœ¨ç ”ç©¶ä¸­ä½¿ç”¨æ­¤é‡‡é›†å‡½æ•°ï¼Œè¯·å¼•ç”¨ï¼š## æœªæ¥æ–¹å‘



```### æ¨èï¼šV3 æœ€å°åŒ–æ”¹è¿›

Dynamic EUR Acquisition Function for Mixed-Type Variables

AEPsych Extensions, 2025ä¿æŒ V1 çš„å…¨éƒ¨è®¾è®¡ï¼Œä»…æ·»åŠ ç¡¬é‡å¤æ’é™¤ï¼š

```

```python

## è®¸å¯è¯class ImprovedAcqfV3(VarianceReductionWithCoverageAcqf):

    """V3: V1 + ç¡¬é‡å¤æ’é™¤"""

éµå¾ªAEPsychä¸»é¡¹ç›®çš„è®¸å¯è¯ã€‚    

    def _evaluate_numpy(self, X_candidates):

---        # ä½¿ç”¨ V1 çš„å…¨éƒ¨é€»è¾‘

        scores = super()._evaluate_numpy(X_candidates)

**ç»´æŠ¤è€…**: AEPsychå¼€å‘å›¢é˜Ÿ          

**æœ€åæ›´æ–°**: 2025-10-30          # å”¯ä¸€æ”¹å˜ï¼šç¡¬æ’é™¤å·²é‡‡æ ·è®¾è®¡

**ç‰ˆæœ¬**: V4 (2.1.0)        for i, x in enumerate(X_candidates):

            design_key = self._design_to_key(x)
            if design_key in self._sampled_designs:
                scores[i] = -np.inf  # ç¡¬æ’é™¤ï¼Œè€Œéè½¯æƒ©ç½š
        
        return scores
```

**é¢„æœŸæ”¹è¿›**:

- å”¯ä¸€è®¾è®¡æ•°: 39 â†’ 55-65 (+40-65%)
- é«˜åˆ†è®¾è®¡: 8 â†’ 12-16 (+50-100%)
- å¹³å‡åˆ†æ•°: 8.72 â†’ 9.0-9.3 (+3-7%)

### å¯é€‰ä¼˜åŒ–

1. **å€™é€‰é›†é¢„è¿‡æ»¤**:
   - 80% ä»æœªé‡‡æ ·è®¾è®¡ + 20% å·²é‡‡æ ·è®¾è®¡
   - å‡å°‘è¯„ä¼°å¼€é”€

2. **è‡ªé€‚åº”è¦†ç›–æƒé‡**:
   - æ—©æœŸè¾ƒé«˜ï¼ˆæ¢ç´¢ï¼‰â†’ åæœŸè¾ƒä½ï¼ˆå¼€å‘ï¼‰
   - ä½†éœ€è°¨æ…ï¼ŒV2 çš„æ•™è®­æ˜¾ç¤ºåŠ¨æ€æƒé‡å¯èƒ½é€‚å¾—å…¶å

## æµ‹è¯•

### è¿è¡Œå•å…ƒæµ‹è¯•

```bash
# V1 å¿«é€ŸéªŒè¯
cd test/categorical_experiment
pixi run python -c "from acquisition_function_v1 import VarianceReductionWithCoverageAcqf; print('âœ“ V1 å¯¼å…¥æˆåŠŸ')"

# å®Œæ•´å®éªŒæµ‹è¯•
pixi run python run_categorical_experiment_v1.py
```

### æ€§èƒ½åŸºå‡†

åŸºäº 80 æ¬¡è¯•éªŒã€360 ä¸ªè®¾è®¡ç©ºé—´çš„åˆ†ç±»å˜é‡å®éªŒï¼š

- **V1**: 10.8% è¦†ç›–ç‡ï¼Œ8 ä¸ªé«˜åˆ†è®¾è®¡ï¼Œå¹³å‡ 8.72 åˆ†
- **V2**: 7.8% è¦†ç›–ç‡ï¼Œ4 ä¸ªé«˜åˆ†è®¾è®¡ï¼Œå¹³å‡ 7.94 åˆ†

## ä¾èµ–é¡¹

- Python 3.8+
- NumPy
- SciPy
- ConfigParser (æ ‡å‡†åº“)
- Matplotlib (ç”¨äºå¯è§†åŒ–)
- AEPsych (ä¸»æ¡†æ¶)

## ç‰ˆæœ¬å†å²

- **V1.0** (2025-10-30): åŸºçº¿ç‰ˆæœ¬ï¼Œç®€å•æœ‰æ•ˆ âœ…
- **V2.0** (2025-10-30): å®éªŒç‰ˆæœ¬ï¼Œå¤±è´¥ä½†æœ‰ä»·å€¼ âš ï¸
- **V3.0** (è®¡åˆ’ä¸­): æœ€å°åŒ–æ”¹è¿›ï¼Œç¡¬æ’é™¤é‡å¤ ğŸ¯

## è´¡çŒ®ä¸åé¦ˆ

æœ¬é¡¹ç›®æ˜¯ AEPsych æ‰©å±•çš„ä¸€éƒ¨åˆ†ã€‚å®éªŒè®¾è®¡ã€å®ç°ä¸åˆ†æå®Œæˆäº 2025å¹´10æœˆ30æ—¥ã€‚

### ç›¸å…³æ–‡æ¡£

- **API æ–‡æ¡£**: `docs/README.md`
- **å¿«é€Ÿå…¥é—¨**: `docs/QUICKSTART.md`
- **å®ç°ç»†èŠ‚**: `docs/IMPLEMENTATION_SUMMARY.md`
- **V2 å¤±è´¥åˆ†æ**: `test/categorical_experiment/report/V2_FAILURE_ANALYSIS.md`
- **å®Œæ•´å®éªŒæŠ¥å‘Š**: `test/categorical_experiment/FINAL_REPORT_V2.md`

## è®¸å¯è¯

éµå¾ªä¸»é¡¹ç›® AEPsych çš„è®¸å¯è¯ã€‚

---

**é‡è¦æç¤º**:

- âœ… **æ¨èä½¿ç”¨ V1 ç‰ˆæœ¬** - ç®€å•ã€ç¨³å®šã€æ•ˆæœå¥½
- âš ï¸ **V2 ä»…ä¾›ç ”ç©¶å‚è€ƒ** - å¤±è´¥å®éªŒï¼Œä½†æä¾›äº†å®è´µçš„æ•™è®­
- ğŸ¯ **V3 å¼€å‘æ–¹å‘æ˜ç¡®** - æœ€å°åŒ–æ”¹åŠ¨ï¼Œç¡¬æ’é™¤é‡å¤

*"The only real mistake is the one from which we learn nothing." - Henry Ford*
