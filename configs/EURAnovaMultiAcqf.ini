# EURAnovaMultiAcqf 采集函数配置
# 
# 模块化ANOVA分解期望效用削减采集函数，支持：
# - 任意阶数交互（主效应 + 二阶 + 三阶 + ...）
# - 动态权重自适应（λ_t, γ_t）
# - 混合变量类型（分类、整数、连续）
# - SPS模型稳定性追踪
#
# 数学公式：
#   α(x) = w_main·(1/d)·∑Δ_j                    # 主效应信息
#         + λ_t·(1/|I_2|)·∑Δ_ij                 # 二阶交互信息
#         + λ_3·(1/|I_3|)·∑Δ_ijk + ...          # 三阶及以上
#         + γ_t·COV(x)                          # 覆盖度约束
#
# 其中：
#   λ_t = f(r_t)      # 动态权重（基于参数方差收敛率）
#   γ_t = g(n, r_t)   # 覆盖度权重（基于样本数和参数不确定性）

[EURAnovaMultiAcqf]

# ========== 核心功能开关 ==========

# 启用主效应（每个维度的边际贡献）
# 类型: bool
# 默认: true
# 说明: false时只计算交互项（不推荐），true时包含主效应
enable_main = true

# 启用二阶交互项
# 类型: bool
# 默认: true
# 说明: 控制是否在ANOVA分解中包含二维交互
enable_pairwise = true

# 启用三阶及更高阶交互项
# 类型: bool
# 默认: true
# 说明: 控制是否在ANOVA分解中包含三维及以上交互
enable_threeway = true

# ========== 交互对配置 ==========

# 二阶交互维度对
# 类型: str 或 list
# 默认: None（自动生成所有对）
# 格式: 多种格式支持
#   - "0,1; 2,3"              # 分号分隔
#   - "(0,1), (2,3)"          # 括号列表
#   - ["0,1", "2,3"]          # 列表格式
# 说明: 指定哪些维度对之间需要计算二阶交互
#   None: 生成所有维度对（C(d, 2)对）
#   指定: 仅计算指定对，减少计算量
#   例: 12维设计，仅计算6对交互可节省85%计算时间
interaction_pairs = None

# 三阶交互维度组
# 类型: str 或 list
# 默认: None（不计算三阶）
# 格式: 类似interaction_pairs，格式为 (i, j, k)
# 说明: 指定哪些维度三元组需要计算三阶交互
#   None: 不计算三阶交互
#   指定: 仅计算指定三元组
#   例: [(0,1,2), (1,2,3)]只计算2个三阶交互
interaction_triplets = None

# ========== 权重参数 ==========

# 主效应权重
# 类型: float
# 默认: 1.0
# 范围: 0.5 - 2.0（推荐）
# 说明: 控制主效应在总信息中的相对权重
#   1.0: 按设计公式（推荐）
#   >1.0: 强调主效应（更保守）
#   <1.0: 弱化主效应（更激进，需谨慎）
main_weight = 1.0

# 二阶交互权重（静态）
# 类型: float 或 None
# 默认: None（使用动态权重）
# 范围: 0.1 - 1.0（如使用静态）
# 说明: 控制二阶交互项的强度
#   None: 使用use_dynamic_lambda=true进行动态调整
#   具体值: 使用固定权重（忽略lambda_min/lambda_max）
#   推荐: 默认None（自适应效果更好）
lambda_2 = None

# 【新增】二阶权重初始值（仅在lambda_2=None时使用）
# 类型: float 或 None
# 默认: None（自动使用lambda_min）
# 范围: 0.1 - 1.0
# 说明: 当启用动态λ时，设置初始值而非lambda_min
#   None: 初始化为lambda_min
#   具体值: 从此值开始动态调整（可加速早期收敛）
#   例: lambda_2_init=0.5使实验初期即探索交互
lambda_2_init = None

# 三阶交互权重
# 类型: float 或 None
# 默认: 0.5
# 范围: 0.1 - 1.0
# 说明: 控制三阶交互项的强度（相对于主效应）
#   None或0.0: 禁用三阶交互
#   0.5: 推荐值（避免过拟合）
#   <0.5: 更强的三阶约束
lambda_3 = 0.5

# ========== 动态权重系统（λ_t） ==========

# 启用二阶权重动态调整
# 类型: bool
# 默认: true
# 说明: 是否根据参数方差比(r_t)动态调整λ_2
#   true: 根据收敛进度自适应λ_2（推荐）
#   false: 使用固定的lambda_2值
use_dynamic_lambda = true

# 动态权重收敛率系数(tau1)
# 类型: float
# 默认: 0.7
# 范围: 0.3 - 1.0
# 说明: 控制λ_t对收敛率(r_t)的敏感度
#   高值(0.7-1.0): 快速响应收敛，早期探索交互（推荐）
#   低值(0.3-0.5): 缓慢响应，后期才加强交互探索
#   公式: λ_t ∝ 1/(1 + exp(-tau1·(r_t - 0.5)))
tau1 = 0.7

# 动态权重稳定性系数(tau2)
# 类型: float
# 默认: 0.3
# 范围: 0.1 - 0.5
# 说明: 控制λ_t的变化速率（平滑度）
#   高值(0.4-0.5): 权重变化缓慢，稳定性好
#   低值(0.1-0.2): 权重快速波动，响应敏捷
#   更新规则: λ_t^new = (1-tau2)·λ_t^old + tau2·λ_target
tau2 = 0.3

# 二阶权重最小值
# 类型: float
# 默认: 0.1
# 范围: 0.01 - 0.3
# 说明: 在动态模式下λ_2的下界（实验后期最低值）
#   0.1: 推荐值（保留交互探索）
#   <0.05: 过度聚焦主效应
#   用于: 即使参数已收敛，仍保持交互探索
lambda_min = 0.1

# 二阶权重最大值
# 类型: float
# 默认: 1.0
# 范围: 0.3 - 1.0
# 说明: 在动态模式下λ_2的上界（实验早期最高值）
#   1.0: 推荐值（充分探索交互）
#   >1.0: 过度强调交互（可能过拟合）
#   用于: 实验初期强力探索多维交互空间
lambda_max = 1.0

# ========== 分段Lambda系统（实验分期调整） ==========

# 启用分段Lambda策略
# 类型: bool
# 默认: false
# 说明: 是否按实验阶段手动设置不同的λ值
#   true: 分phase1/phase2/phase3三段调整
#   false: 使用连续的动态权重（推荐）
use_piecewise_lambda = false

# Phase 1结束的样本数（分段λ）
# 类型: int
# 默认: 35
# 说明: phase1(探索)结束的样本数阈值
#   例: 35表示前35个样本使用piecewise_lambda_high
piecewise_phase1_end = 35

# Phase 2结束的样本数（分段λ）
# 类型: int
# 默认: 50
# 说明: phase2(过渡)结束的样本数阈值
#   例: 50表示35-50用中等权重，51+用低权重
piecewise_phase2_end = 50

# Phase 1和2的Lambda值（分段λ）
# 类型: float
# 默认: 0.35 和 0.70
# 说明: 在分段模式下的固定权重值
#   piecewise_lambda_low:  Phase 1使用（保守）
#   piecewise_lambda_high: Phase 2使用（激进）
piecewise_lambda_low = 0.35
piecewise_lambda_high = 0.70

# ========== 覆盖度权重系统（γ_t） ==========

# 初始覆盖度权重
# 类型: float
# 默认: 0.3
# 范围: 0.1 - 0.5
# 说明: 控制覆盖度目标在采集函数中的初始强度
#   0.3: 推荐值（平衡覆盖和利用）
#   >0.5: 强制均匀探索
#   <0.1: 几乎不考虑覆盖
gamma = 0.3

# 启用覆盖度权重动态调整
# 类型: bool
# 默认: true
# 说明: 是否根据样本数量(n_t)动态调整γ_t
#   true: 早期高覆盖，后期聚焦（推荐）
#   false: 使用固定gamma值
use_dynamic_gamma = true

# 覆盖度权重最大值
# 类型: float
# 默认: 0.5
# 范围: 0.3 - 1.0
# 说明: γ_t的上界（实验早期最高值）
#   0.5: 推荐值（平衡设计）
#   >0.7: 强制覆盖优先
gamma_max = 0.5

# 覆盖度权重最小值
# 类型: float 或 None
# 默认: None（自动=0.05或0.1）
# 范围: 0.01 - 0.2
# 说明: γ_t的下界（实验后期最低值）
#   None: 自动配置（取决于total_budget）
#   0.05: 低预算(<30) 和 高预算(≥30, 0.1)
#   0.1: 推荐值（保留覆盖约束）
gamma_min = None

# 样本数下界（覆盖度权重转换点）
# 类型: int
# 默认: 3
# 范围: 2 - 5
# 说明: 认为参数不确定性高的最低样本数
#   <3: 过度敏感
#   3: 推荐值
#   用途: γ_t = gamma_max当n < tau_n_min
tau_n_min = 3

# 样本数上界（覆盖度权重转换点）
# 类型: int 或 None
# 默认: None（自动或25）
# 范围: 10 - 100
# 说明: 认为参数不确定性低的样本数阈值
#   None: 自动配置(使用total_budget)或默认25
#   >25: γ_t = gamma_min当n > tau_n_max
#   用途: 区分早期探索和后期利用
tau_n_max = None

# 实验总预算
# 类型: int 或 None
# 默认: None（不自动配置）
# 说明: 如指定，自动计算以下参数：
#   - tau_n_max = int(total_budget * 0.7)
#   - gamma_min = 0.05 (if budget<30) 或 0.1 (if budget≥30)
# 范围: 10 - 200
# 例: total_budget=100 → tau_n_max=70, gamma_min=0.1
total_budget = None

# ========== 覆盖度计算方法 ==========

# 覆盖度距离度量
# 类型: str
# 默认: min_distance
# 选项:
#   - min_distance: 到最近样本的欧氏距离
#   - gower_distance: Gower混合距离（支持分类变量）
# 说明: 计算候选点与已有样本的距离
#   min_distance: 适合数值型设计空间
#   gower_distance: 必须当有分类变量时使用
coverage_method = min_distance

# ========== SPS (Skeleton Prediction Stability) 参数 ==========

# 启用SPS模型稳定性追踪
# 类型: bool
# 默认: true
# 说明: 是否使用SPS方法追踪参数方差收敛率(r_t)
#   true: 基于骨架点预测稳定性（推荐）
#   false: 使用贝叶斯方差/参数重叠估计
use_sps = true

# SPS敏感度系数
# 类型: float
# 默认: 8.0
# 范围: 4.0 - 15.0
# 说明: tanh(sensitivity·ΔPred)中的缩放因子
#   高值(8-15): 预测偏差→快速信号变化
#   低值(4-6): 平缓响应，更稳健
#   用途: 放大/缩小模型更新对收敛信号的影响
sps_sensitivity = 8.0

# SPS平滑系数
# 类型: float
# 默认: 0.7
# 范围: 0.5 - 0.9
# 说明: 指数移动平均权重 EMA_t = alpha·raw_rt + (1-alpha)·EMA_{t-1}
#   高值(0.7-0.9): 快速跟踪，敏捷性好
#   低值(0.3-0.5): 高度平滑，长期趋势
#   0.7: 推荐值（平衡）
sps_ema_alpha = 0.7

# ========== 安全机制 ==========

# Gamma安全刹车阈值
# 类型: float
# 默认: 0.5
# 范围: 0.3 - 0.7
# 说明: 当r_t < tau_safe时启动防守性覆盖
#   <0.5: 参数不确定性高，提升覆盖权重
#   >0.5: 参数确定性好，可安全探索交互
#   用途: 防止过早聚焦于交互
tau_safe = 0.5

# Gamma惩罚强度
# 类型: float
# 默认: 0.3
# 范围: 0.1 - 0.5
# 说明: 当启动防守性覆盖时对γ_t的放大倍数
#   0.3: 轻微提升（推荐）
#   >0.5: 激进提升，强制覆盖
gamma_penalty_beta = 0.3

# ========== 融合方式 ==========

# 信息和覆盖的融合方法
# 类型: str
# 默认: additive
# 选项:
#   - additive: α(x) = α_info(x) + γ_t·COV(x)
#   - multiplicative: α(x) = α_info(x)·(1 + γ_t·COV(x))
# 说明: 如何组合信息和覆盖目标
#   additive: 线性和（传统，推荐）
#   multiplicative: 乘法放大（非线性）
fusion_method = additive

# ========== 局部扰动采样 ==========

# 局部扰动幅度（相对于特征范围）
# 类型: float
# 默认: 0.1
# 范围: 0.02 - 0.3
# 说明: 高斯扰动的标准差 = local_jitter_frac × feature_range
#   0.1: 推荐值（±10%范围）
#   <0.05: 扰动太小，覆盖不足
#   >0.2: 扰动过大，局部性丧失
local_jitter_frac = 0.1

# 每个候选点的局部扰动样本数
# 类型: int
# 默认: 4
# 范围: 2 - 20
# 说明: 每个候选点周围生成的扰动变体数
#   4: 推荐值（计算效率与覆盖平衡）
#   <4: 计算快，但局部采样不足
#   >8: 计算成本上升，收益递减
local_num = 4

# 随机种子（可复现性）
# 类型: int 或 None
# 默认: 42
# 说明: 控制局部采样的随机性
#   42: 固定种子（可复现）
#   None: 无种子（每次随机）
random_seed = 42

# ========== 混合扰动策略（新增） ==========

# 启用混合扰动策略
# 类型: bool
# 默认: false
# 说明: 是否对低水平离散变量使用穷举组合
#   true: 低水平变量穷举，高水平变量高斯采样
#   false: 所有离散变量均高斯采样（传统）
#   场景: 有2-3水平分类变量时启用可显著改进覆盖
use_hybrid_perturbation = false

# 穷举策略的水平阈值
# 类型: int
# 默认: 3
# 说明: 有多少水平以下的离散变量使用穷举
#   3: ≤3水平用穷举，≥4水平用高斯（推荐）
#   2: 仅2水平变量穷举（更保守）
#   4: ≤4水平用穷举（更激进）
exhaustive_level_threshold = 3

# 穷举采样的循环填充
# 类型: bool
# 默认: true
# 说明: 当穷举值数<local_num时是否循环填充
#   true: [0,1,2,0,1,...] 循环覆盖（推荐）
#   false: [0,1,2] 截断，可能不足local_num
#   例: 3水平+local_num=5时
#       true  → [0,1,2,0,1] (5个值)
#       false → [0,1,2] (3个值)
exhaustive_use_cyclic_fill = true

# ========== 自动计算Local Num ==========

# 启用local_num自动计算
# 类型: bool
# 默认: false
# 说明: 是否自动计算最优local_num（而非手动设置）
#   true: 根据低水平离散变量自动计算LCM
#   false: 使用手动设置的local_num值（推荐）
#   场景: 变量配置复杂时启用自动计算
auto_compute_local_num = false

# 自动计算的local_num上限
# 类型: int
# 默认: 12
# 说明: 自动计算时的最大值（避免成本爆炸）
#   12: 推荐值（LCM通常<12）
#   <8: 可能遗漏组合
#   >20: 计算成本过高
auto_local_num_max = 12

# ========== 变量类型配置 ==========

# 各维度的变量类型
# 类型: str（逗号或空格分隔）或 dict
# 默认: None（自动推断）
# 格式:
#   - "categorical, continuous, integer"
#   - "c,c,i,c"（缩写）
#   - {0: 'categorical', 2: 'integer'}（字典）
# 说明: 声明每个维度的变量类型
#   categorical: 离散分类型（如性别、颜色）
#   continuous: 连续型（如温度、浓度）
#   integer: 整数型（如数量、阶数）
# 例:
#   # 4维：颜色(分类), 温度(连续), 浓度(连续), 个数(整数)
#   variable_types_list = "categorical, continuous, continuous, integer"
variable_types_list = None

# ========== Gower距离权重（ARD） ==========

# Gower距离中各维度的权重
# 类型: str或 list
# 默认: None（均等权重）
# 格式:
#   - "1, 2, 1, 0.5"（逗号分隔）
#   - [1.0, 2.0, 1.0, 0.5]（列表）
#   - "auto"（基于熵自动计算）
# 说明: 在Gower距离计算中为各维度分配权重
#   None或1.0: 所有维度权重相等
#   >1.0: 该维度权重提升（重视该维度距离）
#   <1.0: 该维度权重降低（弱化该维度距离）
#   "auto": 信息熵高的维度权重更低（自适应）
# 例: ard_weights = "2, 1, 1"表示第0维权重为其他维度的2倍
ard_weights = None

# ========== 调试模式 ==========

# 启用详细诊断输出
# 类型: bool 或 str
# 默认: false
# 说明: 是否打印各模块的计算细节（stderr）
#   false: 无诊断输出
#   true或"true": 启用诊断输出
#   输出包括: 权重更新、ANOVA效应、覆盖度、采集值等
debug_components = false
