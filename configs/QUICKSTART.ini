# EUR (Expected Utility Reduction) ANOVA 多阶采集函数 - 快速开始指南
# ============================================================================
# 本配置基于生产级配置 (eur_config_basegp_prior_with_pool.ini)
# 所有参数已在实际系统中验证
# ============================================================================

[EURAnovaMultiAcqf]
# ========== ANOVA 阶数配置 ==========
enable_main = True
enable_pairwise = True
enable_threeway = False

# ========== 交互对指定 ==========
# 可选：手动指定计算哪些交互对，格式为 "i,j; i,j; ..."
# 例如：interaction_pairs = 3,4; 0,1  表示只计算 (x3,x4) 和 (x0,x1)
# 留空或注释掉则计算所有可能的二阶交互
interaction_pairs = 3,4; 0,1

# ========== 权重参数 ==========
main_weight = 1.0

# 二阶交互权重
lambda_2 = None
use_dynamic_lambda = True
lambda_min = 0.40
lambda_max = 0.70
tau1 = 0.55
tau2 = 0.08

# 三阶交互权重
lambda_3 = 0.5

# ========== 覆盖度(Coverage)权重参数 ==========
gamma = 0.20
use_dynamic_gamma = True
gamma_max = 0.30
gamma_min = 0.05
tau_n_min = 3
tau_n_max = 30
total_budget = 20

# ========== SPS 参数 ==========
use_sps = True
sps_sensitivity = 8.0
sps_ema_alpha = 0.3
tau_safe = 0.5
gamma_penalty_beta = 0.3

# ========== 采样方法 ==========
coverage_method = min_distance
fusion_method = additive

# ========== 本地采样参数 ==========
local_num = 6
local_jitter_frac = 0.1
random_seed = 42

# ========== 混合扰动(离散变量处理) ==========
use_hybrid_perturbation = True
exhaustive_level_threshold = 3
exhaustive_use_cyclic_fill = True

# ========== 自动计算 ==========
auto_compute_local_num = False

# ========== 调试 ==========
debug_components = False


# ============================================================================
# 【详细说明与参数配置指南】
# ============================================================================

# 【1】ANOVA 分解阶数
# ============================================================================
# enable_main: bool
#   启用一阶主效应分解
#   推荐：True（几乎总是需要）
#
# enable_pairwise: bool  
#   启用二阶交互(两个变量的组合效应)
#   推荐：True（通常是方差来源的主要部分）
#
# enable_threeway: bool
#   启用三阶及更高交互
#   推荐：False（降低计算复杂度，除非维度>8且有充足样本）
#
# interaction_pairs: str (可选)
#   手动指定计算哪些二阶交互对
#   格式：逗号分隔索引，分号分隔多对
#   
#   例1：interaction_pairs = 3,4; 0,1
#        计算 (x3,x4) 和 (x0,x1) 两对交互
#   
#   例2：interaction_pairs = 0,1; 0,2; 1,2  
#        计算三角形交互 (3维子问题)
#
#   例3：保持注释或留空
#        # interaction_pairs = 
#        将计算所有可能的二阶交互（完全ANOVA）
#
#   用途：
#   - 减少计算：从 C(n,2) 对交互减少到几对
#   - 领域知识：仅计算已知重要的交互
#   - 高维问题：n=20时 C(20,2)=190对，手动指定可减到3-5对


# 【2】权重参数 (lambda) - 控制信息增益的强度
# ============================================================================
# main_weight: float (推荐=1.0)
#   主效应的权重倍数
#   通常不调整
#
# lambda_2: float or None
#   二阶交互的权重
#   - None（推荐）：使用动态λ_t，根据参数变化率自动调整
#   - 0.1-1.0：固定权重（高级用户）
#
# use_dynamic_lambda: bool
#   启用动态λ_t自动调整
#   推荐：True
#   
#   原理：
#   - 计算参数方差比 r_t = σ²(交互) / σ²(主效应)
#   - 当 r_t < tau2：权重 → lambda_min（交互不重要，减少权重）
#   - 当 r_t > tau1：权重 → lambda_max（交互重要，增加权重）
#
# lambda_min: float (默认=0.40)
#   当交互不重要时的权重下限
#   范围：0.1-0.5
#   更小 → 更信任主效应
#   更大 → 保持交互探索
#
# lambda_max: float (默认=0.70)  
#   当交互重要时的权重上限
#   范围：0.5-1.0
#   必须 > lambda_min
#
# tau1: float (默认=0.55)
#   方差比上阈值
#   当 r_t > tau1 时，λ_t → lambda_max
#
# tau2: float (默认=0.08)
#   方差比下阈值  
#   当 r_t < tau2 时，λ_t → lambda_min
#   必须 < tau1
#
# lambda_3: float (默认=0.5，仅当 enable_threeway=True 时使用)
#   三阶交互权重
#   推荐：0.3-0.6（通常低于二阶权重）


# 【3】覆盖度权重 (gamma) - 平衡探索与利用
# ============================================================================
# gamma: float (初始值，默认=0.20)
#   覆盖度在采集函数中的初始权重
#   范围：0-1，越大越优先探索覆盖
#
# use_dynamic_gamma: bool (推荐=True)
#   启用动态γ_t，根据样本数自动调整
#
# gamma_min: float (默认=0.05)
#   样本充足时的权重下限（转向利用）
#   必须 <= gamma
#
# gamma_max: float (默认=0.30)
#   样本稀少时的权重上限（优先探索）
#   必须 >= gamma
#
# tau_n_min: int (默认=3)
#   样本数下阈值
#   当 n < tau_n_min 时：γ_t → gamma_max（优先探索）
#
# tau_n_max: int (默认=30)
#   样本数上阈值
#   当 n > tau_n_max 时：γ_t → gamma_min（转向利用）
#
# total_budget: int (默认=20)
#   实验总预算（可选）
#   用于自动设置 tau_n_max（如设置则覆盖上述值）
#
# 典型场景：
#   - 快速探索：gamma=0.4, gamma_max=0.7, gamma_min=0.1
#   - 平衡模式：gamma=0.2, gamma_max=0.3, gamma_min=0.05（推荐）
#   - 精细优化：gamma=0.1, gamma_max=0.15, gamma_min=0.02


# 【4】SPS 参数 (Skeleton Prediction Stability)
# ============================================================================
# 用于处理离散变量和离散-连续混合问题的稳定性约束
#
# use_sps: bool (默认=True)
#   启用SPS方法
#   推荐：True（有离散变量时）
#   推荐：False（纯连续问题）
#
# sps_sensitivity: float (默认=8.0)
#   SPS敏感度系数
#   范围：5-15
#   高值 → 更容易触发SPS约束（更保守）
#   低值 → SPS约束更松散（更激进）
#
# sps_ema_alpha: float (默认=0.3)
#   指数移动平均系数
#   范围：0-1
#   高值 → 快速适应变化
#   低值 → 平滑稳定估计
#
# tau_safe: float (默认=0.5)
#   安全刹车阈值
#   当稳定性低于此值时触发SPS保守采样
#
# gamma_penalty_beta: float (默认=0.3)
#   惩罚强度
#   范围：0.2-0.5


# 【5】采样方法
# ============================================================================
# coverage_method: str
#   覆盖度的计算方法
#   
#   "min_distance"（推荐）：
#     覆盖度 = 到最近历史点的距离
#     特点：保证全局分布，倾向均匀覆盖
#     适用：一般问题
#   
#   "mean_distance"：
#     覆盖度 = 到所有历史点的平均距离
#     特点：平滑度量，考虑全局
#     适用：高维问题(n>10)
#
# fusion_method: str
#   信息增益和覆盖的融合方式
#   
#   "additive"（推荐）：
#     α(x) = α_info(x) + γ_t · COV(x)
#     特点：两项线性结合，直观易调
#   
#   "multiplicative"：
#     α(x) = α_info(x) · (1 + γ_t · COV(x))
#     特点：交互式融合，γ作为倍数


# 【6】本地采样参数
# ============================================================================
# local_num: int (默认=6)
#   每个候选点的本地扰动采样数
#   
#   范围：2-20
#   推荐：
#   - 2-4：快速（可能粗糙）
#   - 4-8：平衡（推荐）
#   - 8-16：精细（计算成本高）
#
#   说明：对每个候选点生成 local_num 个邻近点进行评估
#   效果：增加 local_num 可获得更精细的采样，但计算成本 O(local_num)
#
# local_jitter_frac: float (默认=0.1)
#   本地扰动的幅度（相对于特征范围）
#   
#   范围：0.05-0.3
#   0.1 = 特征范围的10%
#   更大 → 探索更远邻域
#   更小 → 精细局部搜索
#
# random_seed: int or None (默认=42)
#   随机种子
#   
#   42 (或任何整数) ：结果可复现
#   None：每次运行不同


# 【7】混合扰动策略(离散变量处理)
# ============================================================================
# use_hybrid_perturbation: bool (默认=True)
#   启用混合离散-连续扰动
#   推荐：True（问题包含分类变量时）
#   推荐：False（纯连续问题）
#
# exhaustive_level_threshold: int (默认=3)
#   离散变量的水平数阈值
#   
#   当变量水平数 <= 此值时，使用穷举方法而非随机采样
#   例：binary(2级) 和 3-level categorical 会使用穷举
#        5-level categorical 会使用随机采样
#   
#   推荐值：3（平衡计算成本和覆盖）
#
# exhaustive_use_cyclic_fill: bool (默认=True)
#   穷举时是否循环填充到 local_num
#   
#   True：穷举所有组合，不足则循环
#   False：仅穷举组合，数量可能 < local_num


# 【8】自动计算
# ============================================================================
# auto_compute_local_num: bool (默认=False)
#   自动计算 local_num 基于变量类型
#   
#   True：根据变量自动设置（不需手动指定 local_num）
#   False：使用手动设置的 local_num
#
# auto_local_num_max: int (当 auto_compute_local_num=True 时使用)
#   自动计算的上限


# ============================================================================
# 【实际使用例】
# ============================================================================

# 例1：有序反应、6维、已知两个关键交互
# --------
# [EURAnovaMultiAcqf]
# enable_main = True
# enable_pairwise = True
# enable_threeway = False
# interaction_pairs = 3,4; 0,1      # ← 仅计算这两对
# use_dynamic_lambda = True
# lambda_min = 0.40
# lambda_max = 0.70
# tau1 = 0.55
# tau2 = 0.08
# gamma = 0.20
# use_dynamic_gamma = True
# gamma_max = 0.30
# gamma_min = 0.05
# tau_n_min = 3
# tau_n_max = 30
# use_sps = True
# sps_sensitivity = 8.0
# coverage_method = min_distance
# local_num = 6
# use_hybrid_perturbation = True
# exhaustive_level_threshold = 3
#
# 【说明】
# - interaction_pairs = "3,4; 0,1" 
#   只计算 (x3,x4) 和 (x0,x1) 两对二阶交互
#   减少从 C(6,2)=15 对到仅 2 对，计算成本大幅下降
#
# - use_dynamic_lambda = True
#   自动监测参数方差，调整λ权重
#
# - use_sps = True
#   处理 x3(4级), x4(3级) 等离散变量的采样稳定性
#
# - local_num = 6 = LCM(2,3,4)
#   对应不同水平数的变量平衡覆盖


# 例2：连续高维、预算充足、无已知交互
# --------
# [EURAnovaMultiAcqf]
# enable_main = True
# enable_pairwise = True
# enable_threeway = True            # ← 启用三阶
# # interaction_pairs =              # ← 留空，计算所有
# use_dynamic_lambda = True
# lambda_min = 0.10
# lambda_max = 0.80
# tau1 = 0.70
# tau2 = 0.30
# gamma = 0.40                      # ← 强覆盖
# use_dynamic_gamma = True
# gamma_max = 0.70
# gamma_min = 0.10
# tau_n_min = 2
# tau_n_max = 100
# use_sps = False                   # ← 纯连续，关闭SPS
# coverage_method = min_distance
# local_num = 8
# use_hybrid_perturbation = False
#
# 【说明】
# - 留空 interaction_pairs
#   计算所有可能的二阶及三阶交互（完全ANOVA分解）
#
# - enable_threeway = True
#   高维空间中三阶交互可能很重要
#
# - gamma = 0.40 (而非 0.20)
#   初始强覆盖驱动，优先探索设计空间
#
# - use_sps = False
#   纯连续优化，无需SPS稳定性约束


# 例3：预算严格、快速反馈
# --------
# [EURAnovaMultiAcqf]
# enable_main = True
# enable_pairwise = True
# enable_threeway = False           # ← 关闭
# interaction_pairs = 0,1; 1,2      # ← 指定关键交互对
# use_dynamic_lambda = True
# lambda_min = 0.10
# lambda_max = 0.50                 # ← 限制范围
# tau1 = 0.60
# tau2 = 0.20
# gamma = 0.50                      # ← 高覆盖
# use_dynamic_gamma = True
# gamma_max = 0.80
# gamma_min = 0.05
# tau_n_min = 1
# tau_n_max = 10
# use_sps = False                   # ← 关闭SPS
# coverage_method = min_distance
# local_num = 3                     # ← 最少采样
# use_hybrid_perturbation = True
#
# 【说明】
# - interaction_pairs = "0,1; 1,2"
#   根据领域知识指定需要的交互对
#   减少不必要的计算
#
# - local_num = 3
#   快速采样，减少计算开销
#
# - gamma = 0.50 (高于推荐值)
#   优先快速覆盖整个设计空间，而非深入交互
#
# - use_sps = False
#   省去额外计算开销


# ============================================================================
# 【变量类型指定说明】(在你的主配置中，不在此文件)
# ============================================================================
#
# 本文件 [EURAnovaMultiAcqf] 仅包含采集函数参数。
# 
# 【方式1】在主配置文件中定义变量（推荐）
# 形如：
#
# [common]
# parnames = [x0, x1, x2, x3, x4, x5]
# outcome_types = [ordinal]
#
# [x0]
# par_type = binary
# lb = 0
# ub = 1
#
# [x1]
# par_type = categorical
# choices = [0, 1, 2, 3, 4]
# lb = 0
# ub = 4
#
# [x3]
# par_type = continuous
# lb = 0.0
# ub = 1.0
#
# 支持的 par_type：
#   - binary：0 或 1（2个水平）
#   - categorical：离散选择（choices 必填）
#   - continuous：连续实数
#   - int：整数
#
#
# 【方式2】在 [EURAnovaMultiAcqf] 中用 variable_types_list 指定（可选）
# 
# variable_types_list 按维度顺序指定变量类型，格式：
#
# variable_types_list = binary, categorical, categorical, categorical, categorical, binary
#   或
# variable_types_list = [binary, categorical, categorical, categorical, categorical, binary]
#   或
# variable_types_list = "binary; cat; cat; cat; cat; binary"
#
# 说明：
#   - 必须按 x0, x1, x2, ... 的顺序列出
#   - 支持简写：cat (categorical), cont (continuous), int (integer), bin (binary)
#   - 支持多种分隔符：逗号, 分号; 空格  
#   - 例如："binary, cat, cat, cat, cat, binary" 等价于
#           "[binary; categorical; categorical; categorical; categorical; binary]"
#
# 【与 exhaustive_level_threshold 的关联】
# 
# variable_types_list (或从主配置推导) 影响离散变量的采样策略：
#   - binary 和 categorical 类型的变量：
#     - 如果 水平数 <= exhaustive_level_threshold (默认3)：使用穷举采样（所有组合）
#     - 如果 水平数 > exhaustive_level_threshold：使用随机采样（减少计算）
#   - continuous 和 int 类型：始终使用连续采样