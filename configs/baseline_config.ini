# 基线配置（不使用混合扰动策略）
#
# 用途：作为对比实验的基线组，验证混合扰动策略的效果
#
# 使用场景：
# - 6个自变量，每个变量2-3个水平
# - Pool-based主动学习（有限候选池）
# - 20-30次采样预算
# - 序数响应（如Likert量表）或连续响应
#
# 与优化版的差异：
# 1. use_hybrid_perturbation = False（关键差异）
# 2. local_num = 4（原始配置）
# 3. 其他参数保持一致，确保对照实验的有效性

[EURAnovaPairAcqf]
# ===== 基础参数 =====
main_weight = 1.0  # ✅ 保持默认（符合设计公式）

# ===== 动态λ_t参数（交互效应自适应）=====
use_dynamic_lambda = True  # ✅ 启用动态交互权重
tau1 = 0.7  # r_t上阈值（>0.7时参数不确定，降低交互权重）
tau2 = 0.3  # r_t下阈值（<0.3时参数已收敛，提高交互权重）
lambda_min = 0.1  # 最小交互权重（初期，参数不确定时）
lambda_max = 1.0  # 最大交互权重（后期，参数已收敛时）

# ===== 动态γ_t参数（信息/覆盖平衡）=====
use_dynamic_gamma = True  # ✅ 启用动态覆盖权重

# 【针对20-30次采样预算的优化配置】
gamma_max = 0.5      # 早期高覆盖（前3次）
gamma_min = 0.05     # 后期低覆盖（20次后），聚焦信息增益
tau_n_min = 3        # 3次采样前高覆盖
tau_n_max = 20       # 20次后转向精细化（适配小预算）

# ===== 【基线配置】不使用混合扰动策略 =====
use_hybrid_perturbation = False  # ❌ 禁用混合扰动（基线对照组）
exhaustive_level_threshold = 3   # （不使用，仅为向后兼容）
exhaustive_use_cyclic_fill = True  # （不使用，仅为向后兼容）

# ===== 局部扰动参数 =====
local_jitter_frac = 0.1  # 扰动幅度为范围的10%
local_num = 4            # 原始配置（不增加）

# 【基线配置说明】
# - 分类变量：随机采样4个值（可能重复或遗漏某些水平）
# - 整数变量：高斯扰动后舍入（可能重复或遗漏某些整数）
# - 连续变量：高斯扰动（与优化版相同）
#
# 潜在问题（混合扰动策略要解决的）：
# - 2水平变量：随机采样4次可能得到[0,0,0,1]或[1,1,1,0]（严重不均衡）
# - 3水平变量：随机采样4次可能遗漏某个水平，如[0,1,1,2]（缺少足够的水平0样本）
# - 导致Δ_i计算不准确，影响效应发现质量

# ===== 交互对配置 =====
# 【保持与优化版一致】确保对照实验的有效性
interaction_pairs = "0,1; 0,2; 0,3; 0,4; 0,5; 1,2; 1,3; 1,4; 1,5; 2,3; 2,4; 2,5; 3,4; 3,5; 4,5"

# ===== 变量类型配置（示例）=====
# 【保持与优化版一致】
variable_types_list = "categorical, categorical, categorical, categorical, categorical, categorical"

# ===== 覆盖度设置 =====
coverage_method = "min_distance"  # Gower距离的最小距离法

# ===== 随机种子（确保可重复）=====
random_seed = 42  # 【重要】使用相同种子确保公平对比

# ===== 调试选项 =====
debug_components = False  # 设为True可查看各分量贡献

# ========================================
# 对比实验指南
# ========================================
#
# 实验设计：
# 1. 基线组（当前配置）：
#    - use_hybrid_perturbation = False
#    - local_num = 4
#    - 运行N次独立实验（建议N≥10）
#
# 2. 实验组（hybrid_perturbation_optimized.ini）：
#    - use_hybrid_perturbation = True
#    - local_num = 6
#    - 运行N次独立实验（使用相同的随机池和真实效应）
#
# 3. 评估指标：
#    a) 效应发现能力：
#       - 回归模型R²（越高越好）
#       - 主效应显著性检测准确率
#       - 交互效应显著性检测准确率
#
#    b) 参数估计质量：
#       - 效应量估计RMSE（越低越好）
#       - 95% CI覆盖率（应≥95%）
#       - 95% CI平均宽度（越窄越好）
#
#    c) 选点质量：
#       - 采集函数分量分析（主效应vs交互效应贡献）
#       - 设计空间覆盖度（Gower距离分布）
#
# 4. 统计检验：
#    - 配对t检验（基线 vs 优化）
#    - Wilcoxon符号秩检验（非参数）
#    - Cohen's d效应量
#
# 预期结果：
# - 优化版应在效应发现准确率上显著优于基线（p<0.05）
# - 原因：完全覆盖2-3水平变量，减少遗漏和偏差

# ========================================
# 使用示例
# ========================================
"""
from aepsych.server import AEPsychServer

# 1. 加载基线配置
with open('configs/baseline_config.ini') as f:
    config_str = f.read()

# 2. 创建服务器
server = AEPsychServer()
server.configure(config_str=config_str)

# 3. 运行实验（与优化版流程相同）
for trial in range(25):
    next_x = server.ask()
    outcome = get_subject_response(next_x)
    server.tell(config_str, outcome)

# 4. 保存结果用于对比分析
results = {
    'config': 'baseline',
    'R2': compute_R2(server.strat.model),
    'effect_detection': detect_significant_effects(server.strat.model),
    # ... 其他指标
}
"""

# ========================================
# 注意事项
# ========================================

# 1. 随机种子控制：
#    - 基线和优化版使用相同的random_seed
#    - 但要运行多次实验（每次使用不同种子）以获得统计显著性
#    - 建议：seed ∈ {42, 43, 44, ..., 51}（10次重复）

# 2. 真实效应一致性：
#    - 对比实验必须使用相同的真实响应函数
#    - 建议使用模拟数据确保完全一致性

# 3. 候选池一致性：
#    - 如果使用pool-based采样，确保两组使用相同的候选池
#    - 或使用相同种子生成候选池

# 4. 预算一致性：
#    - warmup阶段和EUR阶段的样本数必须一致
#    - 建议：warmup=10, EUR=15, 总计25次
