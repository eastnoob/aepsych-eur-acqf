# DynamicWeightEngine 权重引擎配置
#
# 两种动态权重系统的详细参数说明
# 1. λ_t：二阶交互权重（基于参数方差收敛率r_t）
# 2. γ_t：覆盖度权重（基于样本数量n_t和参数不确定性）
#
# 权重更新流程：
#   [1] 计算r_t (SPS或其他方法追踪参数收敛)
#   [2] 根据r_t计算λ_target(r_t)
#   [3] EMA平滑：λ_t^new = (1-tau2)·λ_t^old + tau2·λ_target
#   [4] 根据n_t计算γ_t（分段线性或分段常数）
#   [5] 应用安全机制（防守覆盖）

[DynamicWeightEngine]

# ========== 二阶权重(λ_t)动态调整 ==========

# 启用lambda_2动态调整
# 类型: bool
# 默认: true
# 说明: 是否根据收敛进度自适应调整λ_2
#   true: 按r_t动态更新（推荐）
#   false: 使用固定值lambda_2（如果已指定）
use_dynamic_lambda = true

# Lambda目标函数的上升速率
# 类型: float
# 默认: 0.7
# 范围: 0.3 - 1.0
# 说明: sigmoid函数的斜率参数
#   公式: λ_target = lambda_max / (1 + exp(-tau1·(r_t - 0.5)))
#   高值(0.7-1.0): r_t在0.5附近时快速上升（早期探索）
#   低值(0.3-0.5): 缓慢上升，后期才加强（谨慎）
#   0.7: 推荐值（平衡早期探索与稳定性）
#
# 直观理解：
#   r_t < 0.5: 参数不确定性高，λ_target低
#   r_t = 0.5: λ_target = lambda_max/2（转折点）
#   r_t > 0.5: 参数确定性好，λ_target升至lambda_max
tau1 = 0.7

# Lambda平滑系数（EMA权重）
# 类型: float
# 默认: 0.3
# 范围: 0.1 - 0.5
# 说明: 新旧权重的混合比例
#   公式: λ_t^new = (1-tau2)·λ_t^old + tau2·λ_target
#   高值(0.4-0.5): 新值权重大，快速响应
#   低值(0.1-0.2): 旧值权重大，变化平缓
#   0.3: 推荐值（约3次迭代达到稳定）
#   用途: 防止权重剧烈震荡
tau2 = 0.3

# Lambda下界
# 类型: float
# 默认: 0.1
# 范围: 0.01 - 0.3
# 说明: λ_t的最小允许值
#   0.1: 推荐值（即使参数收敛，仍保留10%的交互探索）
#   <0.05: 过度聚焦主效应，可能遗漏交互
#   用途: 实验后期仍保证最低交互探索
lambda_min = 0.1

# Lambda上界
# 类型: float
# 默认: 1.0
# 范围: 0.3 - 1.0+
# 说明: λ_t的最大允许值
#   1.0: 推荐值（充分探索交互）
#   >1.0: 过度强调交互（风险：过拟合）
#   <0.5: 保守设置（交互权重受限）
#   用途: 实验早期能达到的最高交互权重
lambda_max = 1.0

# 【新增】Lambda初始值
# 类型: float 或 None
# 默认: None（自动使用lambda_min）
# 范围: lambda_min - lambda_max
# 说明: λ_0的起始值（用于第一次迭代）
#   None: 初始化为lambda_min
#   具体值: 从此值开始EMA更新
#   例: lambda_2_init=0.5可在实验初期即探索交互
lambda_2_init = None

# ========== 分段Lambda系统（可选） ==========

# 启用分段Lambda
# 类型: bool
# 默认: false
# 说明: 是否按实验阶段手动分段调整λ值
#   true: 按三个阶段设置（覆盖use_dynamic_lambda）
#   false: 使用连续的动态权重（推荐）
use_piecewise_lambda = false

# Phase 1结束的样本数
# 类型: int
# 默认: 35
# 范围: 10 - 50
# 说明: 探索阶段的结束点
#   <35: 早期结束探索
#   35: 推荐值
#   >50: 延长探索期
piecewise_phase1_end = 35

# Phase 2结束的样本数
# 类型: int
# 默认: 50
# 范围: 40 - 100
# 说明: 过渡阶段的结束点
#   <50: 快速进入最终阶段
#   50: 推荐值
#   >70: 延长过渡期
piecewise_phase2_end = 50

# Phase 1使用的Lambda值（分段）
# 类型: float
# 默认: 0.35
# 范围: 0.1 - 0.7
# 说明: n < phase1_end时的权重
#   0.35: 保守的早期权重
#   0.5: 中等权重
#   >0.6: 激进探索
piecewise_lambda_low = 0.35

# Phase 2使用的Lambda值（分段）
# 类型: float
# 默认: 0.70
# 范围: 0.3 - 1.0
# 说明: phase1_end ≤ n < phase2_end时的权重
#   0.70: 推荐值（过渡期加强探索）
#   >0.8: 激进过渡
#   <0.5: 保守过渡
piecewise_lambda_high = 0.70

# ========== 覆盖度权重(γ_t)动态调整 ==========

# 启用gamma动态调整
# 类型: bool
# 默认: true
# 说明: 是否根据样本数量n_t动态调整γ_t
#   true: 早期高覆盖，后期聚焦（推荐）
#   false: 使用固定gamma值
use_dynamic_gamma = true

# Gamma初始值（早期覆盖）
# 类型: float
# 默认: 0.3
# 范围: 0.1 - 0.5
# 说明: 实验初期的覆盖度权重
#   0.3: 推荐值（平衡覆盖和利用）
#   >0.5: 强制均匀覆盖
#   <0.1: 几乎不考虑覆盖
gamma_initial = 0.3

# Gamma最大值
# 类型: float
# 默认: 0.5
# 范围: 0.3 - 1.0
# 说明: γ_t的上界（通常出现在早期）
#   0.5: 推荐值
#   >0.7: 强制覆盖优先
#   用于: n < tau_n_min时γ_t ≈ gamma_max
gamma_max = 0.5

# Gamma最小值
# 类型: float 或 None
# 默认: None（自动配置0.05或0.1）
# 范围: 0.01 - 0.2
# 说明: γ_t的下界（通常出现在后期）
#   None: 自动配置
#   0.05: 低预算(<30)推荐
#   0.1: 中/高预算(≥30)推荐
#   用于: n > tau_n_max时γ_t ≈ gamma_min
gamma_min = None

# ========== Gamma转换点（分段） ==========

# 样本数下界（高覆盖阈值）
# 类型: int
# 默认: 3
# 范围: 2 - 5
# 说明: 认为参数不确定性高的最低样本数
#   <3: 过度敏感
#   3: 推荐值
#   用途: 当n < tau_n_min时γ_t = gamma_max
tau_n_min = 3

# 样本数上界（低覆盖阈值）
# 类型: int 或 None
# 默认: None（自动或25）
# 范围: 10 - 100
# 说明: 认为参数不确定性低的样本数
#   None: 自动配置或默认25
#   用途: 当n > tau_n_max时γ_t = gamma_min
#   区分早期探索(n<tau_n_min)和后期利用(n>tau_n_max)
tau_n_max = None

# ========== SPS系统参数 ==========

# 启用SPS（骨架预测稳定性）
# 类型: bool
# 默认: true
# 说明: 是否使用SPS方法计算参数方差收敛率r_t
#   true: 基于骨架点预测稳定性追踪（推荐）
#   false: 使用其他方法（如贝叶斯方差）
use_sps = true

# SPS敏感度系数
# 类型: float
# 默认: 8.0
# 范围: 4.0 - 15.0
# 说明: tanh(sensitivity·ΔPred)中的缩放因子
#   公式: r_t_raw = tanh(sps_sensitivity × mean(ΔPred))
#   高值(8-15): 预测偏差→快速信号变化（敏捷）
#   低值(4-6): 平缓响应，更稳健（保守）
#   8.0: 推荐值（中等敏感）
#
# 直观理解：
#   sensitivity=4:  ΔPred=0.01 → r_raw≈0.04（缓慢）
#   sensitivity=8:  ΔPred=0.01 → r_raw≈0.08（中等）
#   sensitivity=12: ΔPred=0.01 → r_raw≈0.12（敏捷）
sps_sensitivity = 8.0

# SPS平滑系数（EMA）
# 类型: float
# 默认: 0.7
# 范围: 0.3 - 0.9
# 说明: r_t的指数移动平均权重
#   公式: r_t_smooth = alpha·r_t_raw + (1-alpha)·r_{t-1}_smooth
#   高值(0.7-0.9): 快速跟踪新信号，敏捷
#   低值(0.3-0.5): 高度平滑，长期趋势
#   0.7: 推荐值（平衡）
#
# 迭代次数看：
#   alpha=0.7: 约3次迭代达到稳定
#   alpha=0.5: 约7次迭代达到稳定
#   alpha=0.3: 约10次迭代达到稳定
sps_ema_alpha = 0.7

# ========== 安全机制 ==========

# Gamma防守阈值
# 类型: float
# 默认: 0.5
# 范围: 0.3 - 0.7
# 说明: 当r_t < tau_safe时启动防守性覆盖
#   <0.5: 参数不确定性高，启动防守提升γ
#   ≥0.5: 参数确定性好，正常γ权重
#   0.5: 推荐值（中等敏感）
#   用途: 防止过早聚焦于交互而忽视覆盖
tau_safe = 0.5

# Gamma惩罚系数（防守覆盖）
# 类型: float
# 默认: 0.3
# 范围: 0.1 - 0.5
# 说明: 启动防守覆盖时对γ的增强倍数
#   公式: γ_defended = γ_t + gamma_penalty_beta × (gamma_max - γ_t)
#   0.3: 轻微提升（推荐，保守）
#   0.5: 中等提升（平衡）
#   >0.5: 激进提升，强制覆盖
#   用途: 当r_t低于安全阈值时防守性地增加覆盖
gamma_penalty_beta = 0.3

# ========== 实验预算自适应 ==========

# 实验总预算
# 类型: int 或 None
# 默认: None（不自动配置）
# 说明: 如指定，自动配置相关参数
#   自动配置项:
#     - tau_n_max = int(total_budget × 0.7)
#     - gamma_min = 0.05 (if budget<30) 或 0.1 (if budget≥30)
# 范围: 10 - 200
# 例:
#   budget=100 → tau_n_max=70, gamma_min=0.1
#   budget=30  → tau_n_max=21, gamma_min=0.05
total_budget = None
